var qn=Object.defineProperty;var Jn=(t,e,r)=>e in t?qn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var He=(t,e,r)=>(Jn(t,typeof e!="symbol"?e+"":e,r),r),Ir=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var O=(t,e,r)=>(Ir(t,e,"read from private field"),r?r.call(t):e.get(t)),ie=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},ye=(t,e,r,i)=>(Ir(t,e,"write to private field"),i?i.call(t,r):e.set(t,r),r);var F=(t,e,r)=>(Ir(t,e,"access private method"),r);import{S as Gn,i as Wn,s as zn,k as _r,q as en,a as tn,l as Tr,m as rn,r as nn,h as Qe,c as an,n as on,b as kt,G as sn,J as cn,H as Sr,K as Yn}from"../chunks/index.3806aa4f.js";class Xn extends Number{constructor(e){const[r]=new Int8Array([e]);super(r)}valueOf(){return super.valueOf()}get[Symbol.toStringTag](){return"Byte"}}class Wt extends Number{constructor(e){const[r]=new Int16Array([e]);super(r)}valueOf(){return super.valueOf()}get[Symbol.toStringTag](){return"Short"}}class rt extends Number{constructor(e){const[r]=new Int32Array([e]);super(r)}valueOf(){return super.valueOf()}get[Symbol.toStringTag](){return"Int"}}class Kn extends Number{constructor(e){const[r]=new Float32Array([e]);super(r)}valueOf(){return super.valueOf()}get[Symbol.toStringTag](){return"Float"}}class Ut{constructor(e,{name:r,endian:i,compression:o,bedrockLevel:s}={}){if(e instanceof Ut&&(r===void 0&&(r=e.name),i===void 0&&(i=e.endian),o===void 0&&(o=e.compression),s===void 0&&(s=e.bedrockLevel),e=e.data),r===void 0&&(r=""),i===void 0&&(i="big"),o===void 0&&(o=null),s===void 0&&(s=null),typeof e!="object"||e===null)throw new TypeError("First parameter must be an object");if(typeof r!="string"&&r!==null)throw new TypeError("Name option must be a string or null");if(i!=="big"&&i!=="little")throw new TypeError("Endian option must be a valid endian type");if(o!==null&&o!=="gzip"&&o!=="deflate")throw new TypeError("Compression option must be a valid compression type");if(s!==null&&!(s instanceof rt))throw new TypeError("Bedrock Level option must be an Int");this.data=e,this.name=r,this.endian=i,o!==null&&(this.compression=o),s!==null&&(this.bedrockLevel=s),Object.freeze(this)}get[Symbol.toStringTag](){return"NBTData"}}const X={END:0,BYTE:1,SHORT:2,INT:3,LONG:4,FLOAT:5,DOUBLE:6,BYTE_ARRAY:7,STRING:8,LIST:9,COMPOUND:10,INT_ARRAY:11,LONG_ARRAY:12};Object.freeze(X);function wt(t){switch(!0){case t instanceof Xn:case typeof t=="boolean":return X.BYTE;case t instanceof Wt:return X.SHORT;case t instanceof rt:return X.INT;case typeof t=="bigint":return X.LONG;case t instanceof Kn:return X.FLOAT;case typeof t=="number":return X.DOUBLE;case t instanceof Int8Array:return X.BYTE_ARRAY;case typeof t=="string":return X.STRING;case t instanceof Array:return X.LIST;case t instanceof Int32Array:return X.INT_ARRAY;case t instanceof BigInt64Array:return X.LONG_ARRAY;case(typeof t=="object"&&t!==null):return X.COMPOUND;default:return null}}async function fn(t,{format:e="gzip"}={}){const r=new CompressionStream(e),i=new Blob([t]).stream().pipeThrough(r),o=await new Response(i).arrayBuffer();return new Uint8Array(o)}async function $n(t,{name:e,endian:r,compression:i,bedrockLevel:o}={}){if(t instanceof Ut&&(e===void 0&&(e=t.name),r===void 0&&(r=t.endian),i===void 0&&(i=t.compression),o===void 0&&(o=t.bedrockLevel),t=t.data),typeof t!="object"||t===null)throw new TypeError("First parameter must be an object");if(e!==void 0&&typeof e!="string"&&e!==null)throw new TypeError("Name option must be a string or null");if(r!==void 0&&r!=="big"&&r!=="little")throw new TypeError("Endian option must be a valid endian type");if(i!=null&&i!=="gzip"&&i!=="deflate")throw new TypeError("Compression option must be a valid compression type");if(o!=null&&!(o instanceof rt))throw new TypeError("Bedrock Level option must be an Int");let n=new Zn().write(t,{name:e,endian:r});if(o!=null){const{byteLength:f}=n,u=new Uint8Array(f+8),l=new DataView(u.buffer),x=o.valueOf();l.setUint32(0,x,!0),l.setUint32(4,f,!0),u.set(n,8),n=u}return i==="gzip"&&(n=await fn(n,{format:"gzip"})),i==="deflate"&&(n=await fn(n,{format:"deflate"})),n}var Y,Ve,Ne,Ce,Kt,we,Pe,St,Ur,tt,It,$t,dn,Zt,pn,Qt,mn,er,bn,Xe,et,Bt,Er,tr,yn,rr,vn,nr,gn,lt,zt,ir,xn,Ot,Nr,ar,kn,or,wn;class Zn{constructor(){ie(this,we);ie(this,St);ie(this,tt);ie(this,$t);ie(this,Zt);ie(this,Qt);ie(this,er);ie(this,Xe);ie(this,Bt);ie(this,tr);ie(this,rr);ie(this,nr);ie(this,lt);ie(this,ir);ie(this,Ot);ie(this,ar);ie(this,or);ie(this,Y,void 0);ie(this,Ve,void 0);ie(this,Ne,void 0);ie(this,Ce,void 0);ie(this,Kt,new TextEncoder)}write(e,{name:r,endian:i}={}){if(e instanceof Ut&&(r===void 0&&(r=e.name),i===void 0&&(i=e.endian),e=e.data),r===void 0&&(r=""),i===void 0&&(i="big"),typeof e!="object"||e===null)throw new TypeError("First parameter must be an object");if(typeof r!="string"&&r!==null)throw new TypeError("Name option must be a string or null");if(i!=="big"&&i!=="little")throw new TypeError("Endian option must be a valid endian type");return ye(this,Y,0),ye(this,Ve,i==="little"),ye(this,Ne,new Uint8Array(1024)),ye(this,Ce,new DataView(O(this,Ne).buffer)),F(this,tt,It).call(this,X.COMPOUND),r!==null&&F(this,lt,zt).call(this,r),F(this,Ot,Nr).call(this,e),F(this,we,Pe).call(this,0),O(this,Ne).slice(0,O(this,Y))}}Y=new WeakMap,Ve=new WeakMap,Ne=new WeakMap,Ce=new WeakMap,Kt=new WeakMap,we=new WeakSet,Pe=function(e){const r=O(this,Y)+e;if(O(this,Ne).byteLength>=r)return;let i=O(this,Ne).byteLength;for(;i<r;)i*=2;const o=new Uint8Array(i);o.set(O(this,Ne),0),O(this,Y)>O(this,Ne).byteLength&&o.fill(0,e,O(this,Y)),ye(this,Ne,o),ye(this,Ce,new DataView(o.buffer))},St=new WeakSet,Ur=function(e){switch(wt(e)){case X.BYTE:return F(this,Zt,pn).call(this,Number(e));case X.SHORT:return F(this,er,bn).call(this,e.valueOf());case X.INT:return F(this,Xe,et).call(this,e.valueOf());case X.LONG:return F(this,Bt,Er).call(this,e);case X.FLOAT:return F(this,tr,yn).call(this,e.valueOf());case X.DOUBLE:return F(this,rr,vn).call(this,e);case X.BYTE_ARRAY:return F(this,nr,gn).call(this,e);case X.STRING:return F(this,lt,zt).call(this,e);case X.LIST:return F(this,ir,xn).call(this,e);case X.COMPOUND:return F(this,Ot,Nr).call(this,e);case X.INT_ARRAY:return F(this,ar,kn).call(this,e);case X.LONG_ARRAY:return F(this,or,wn).call(this,e)}},tt=new WeakSet,It=function(e){F(this,$t,dn).call(this,e)},$t=new WeakSet,dn=function(e){F(this,we,Pe).call(this,1),O(this,Ce).setUint8(O(this,Y),e),ye(this,Y,O(this,Y)+1)},Zt=new WeakSet,pn=function(e){F(this,we,Pe).call(this,1),O(this,Ce).setInt8(O(this,Y),e),ye(this,Y,O(this,Y)+1)},Qt=new WeakSet,mn=function(e){F(this,we,Pe).call(this,2),O(this,Ce).setUint16(O(this,Y),e,O(this,Ve)),ye(this,Y,O(this,Y)+2)},er=new WeakSet,bn=function(e){F(this,we,Pe).call(this,2),O(this,Ce).setInt16(O(this,Y),e,O(this,Ve)),ye(this,Y,O(this,Y)+2)},Xe=new WeakSet,et=function(e){F(this,we,Pe).call(this,4),O(this,Ce).setInt32(O(this,Y),e,O(this,Ve)),ye(this,Y,O(this,Y)+4)},Bt=new WeakSet,Er=function(e){F(this,we,Pe).call(this,8),O(this,Ce).setBigInt64(O(this,Y),e,O(this,Ve)),ye(this,Y,O(this,Y)+8)},tr=new WeakSet,yn=function(e){F(this,we,Pe).call(this,4),O(this,Ce).setFloat32(O(this,Y),e,O(this,Ve)),ye(this,Y,O(this,Y)+4)},rr=new WeakSet,vn=function(e){F(this,we,Pe).call(this,8),O(this,Ce).setFloat64(O(this,Y),e,O(this,Ve)),ye(this,Y,O(this,Y)+8)},nr=new WeakSet,gn=function(e){const{length:r}=e;F(this,Xe,et).call(this,r),F(this,we,Pe).call(this,r),O(this,Ne).set(e,O(this,Y)),ye(this,Y,O(this,Y)+r)},lt=new WeakSet,zt=function(e){const r=O(this,Kt).encode(e),{length:i}=r;F(this,Qt,mn).call(this,i),F(this,we,Pe).call(this,i),O(this,Ne).set(r,O(this,Y)),ye(this,Y,O(this,Y)+i)},ir=new WeakSet,xn=function(e){e=e.filter(o=>wt(o)!==null);const r=e.length!==0?wt(e[0]):X.END,{length:i}=e;F(this,tt,It).call(this,r),F(this,Xe,et).call(this,i);for(const o of e){if(wt(o)!==r)throw new TypeError("Encountered unexpected item type in array, all tags in a List tag must be of the same type");F(this,St,Ur).call(this,o)}},Ot=new WeakSet,Nr=function(e){for(const[r,i]of Object.entries(e)){const o=wt(i);o!==null&&(F(this,tt,It).call(this,o),F(this,lt,zt).call(this,r),F(this,St,Ur).call(this,i))}F(this,tt,It).call(this,X.END)},ar=new WeakSet,kn=function(e){const{length:r}=e;F(this,Xe,et).call(this,r);for(const i of e)F(this,Xe,et).call(this,i)},or=new WeakSet,wn=function(e){const{length:r}=e;F(this,Xe,et).call(this,r);for(const i of e)F(this,Bt,Er).call(this,i)};const Le=class{constructor(e){He(this,"name");He(this,"index");this.name=e,this.index=Le.maxTags}static create(e){if(Le.palette[e])return Le.blocks[Le.palette[e].valueOf()];const r=new Le(e);return Le.maxTags+=1,Le.blocks.push(r),Le.palette[r.name]=new rt(r.index),r}static get(e){return Le.blocks[e]}};let ae=Le;He(ae,"maxTags",0),He(ae,"blocks",[]),He(ae,"palette",{});class Qn{constructor(e,r,i){He(this,"width");He(this,"height");He(this,"length");He(this,"blockData");this.width=new Wt(e),this.height=new Wt(r),this.length=new Wt(i),this.blockData=new Int8Array(e*r*i).fill(0)}positionToIndex(e,r,i){return e+i*this.width.valueOf()+r*this.width.valueOf()*this.length.valueOf()}setBlock(e,r,i,o){this.blockData[this.positionToIndex(e,r,i)]=o.index.valueOf()}getBlock(e,r,i){return this.blockData[this.positionToIndex(e,r,i)]}get Width(){return this.width.valueOf()}get Height(){return this.height.valueOf()}get Length(){return this.length.valueOf()}toNBT(){const e={Version:new rt(2),DataVersion:new rt(2975),Width:this.width,Height:this.height,Length:this.length,BlockData:this.blockData,PaletteMax:new rt(ae.maxTags),Palette:ae.palette};return new Ut(e,{name:"Schematic"})}}const un=ae.create("minecraft:air"),Cr=ae.create("minecraft:repeater"),qe=ae.create("minecraft:white_concrete"),Ie=ae.create("minecraft:redstone_wire"),Fr=ae.create("minecraft:observer[facing=down]"),ei=ae.create("minecraft:powered_rail[shape=east_west]"),ti=ae.create("minecraft:redstone_block"),Mr=ae.create("minecraft:redstone_lamp"),ri=ae.create("minecraft:sticky_piston[facing=south]"),ni=ae.create("minecraft:lever[face=floor]"),ii=[ae.create("minecraft:oak_planks"),ae.create("minecraft:white_wool"),ae.create("minecraft:dirt"),ae.create("minecraft:clay"),ae.create("minecraft:gold_block")],ai=t=>{for(let e=0;e<t.Width;e++)for(let r=0;r<t.Length;r++)t.setBlock(e,0,r,qe),t.setBlock(e,6,r,qe)},oi=(t,e,r=0)=>{const i=(r+5)%2;for(let o=0;o<t.Length;o++)o>=5&&(o%2==i?(t.setBlock(e+1,1,o,Cr),t.setBlock(e-1,1,o,Cr)):(t.setBlock(e+1,1,o,Mr),t.setBlock(e-1,1,o,Mr)))},si=(t,e,r=0)=>{const i=(r+5)%2;for(let o=r+5;o<t.Length;o++)o%2!==i?t.setBlock(e+1,2,o,Fr):t.setBlock(e-1,2,o,Fr)},ci=(t,e=0)=>{for(let r=e+5;r<t.Length;r++)for(let i=0;i<t.Width;i++)t.setBlock(i,3,r,qe),t.setBlock(i,4,r,ei),t.setBlock(i,5,r,Fr)},fi=(t,e,r=0)=>{for(let i=r+5;i<t.Length;i++)t.setBlock(e,7,i,Mr)},ui=(t,e,r=0)=>{ai(t),oi(t,e,r),si(t,e,r),ci(t,r),fi(t,e,r)},li=(t,e,r=0)=>{t.setBlock(e,7,r,ni),hi(t,e,r),di(t,e,r),pi(t,e,r)},hi=(t,e,r=0)=>{t.setBlock(e,5,r+0,Ie),t.setBlock(e,4,r+0,qe),t.setBlock(e,4,r+1,Ie),t.setBlock(e,3,r+1,qe),t.setBlock(e+1,3,r+1,Ie),t.setBlock(e+1,2,r+1,qe),t.setBlock(e+1,2,r+0,Ie),t.setBlock(e+1,1,r+0,qe)},di=(t,e,r=0)=>{t.setBlock(e+1,1,r+1,Cr),t.setBlock(e+1,1,r+2,Ie),t.setBlock(e+1,1,r+3,Ie),t.setBlock(e+1,1,r+4,Ie)},pi=(t,e,r=0)=>{t.setBlock(e,1,r,Ie),t.setBlock(e-1,1,r,Ie),t.setBlock(e-2,1,r,Ie),t.setBlock(e-2,1,r+1,qe),t.setBlock(e-2,2,r+1,Ie),t.setBlock(e-2,2,r+2,ri),t.setBlock(e-2,2,r+3,qe),t.setBlock(e-2,1,r+3,Ie),t.setBlock(e-2,0,r+3,ti),t.setBlock(e-1,1,r+3,qe),t.setBlock(e-1,2,r+3,Ie),t.setBlock(e-1,1,r+4,Ie)},In=t=>Math.round(t*5),mi=(t,e,r,i,o)=>{let s=e-Math.round(r.velocity*e/128);const n=In(r.time)+o+5,f=ae.create(`minecraft:note_block[note=${r.midi-54}]`),u=s>e/2?-1:1;for(;s>0&&s<=e;){if(t.getBlock(e+s,7,n)===un.index){t.setBlock(e+s,7,n,f),t.setBlock(e+s,6,n,i);break}else if(t.getBlock(e-s,7,n)===un.index){t.setBlock(e-s,7,n,f),t.setBlock(e-s,6,n,i);break}s+=u}},bi=(t,e,r,i=0)=>{r.tracks.forEach((o,s)=>{o.notes.forEach(n=>{mi(t,e,n,ii[s],i)})})},yi=(t,e=7,r=5)=>{const i=new Qn(e*2+1,8,In(t.duration+1));return ui(i,e,r),li(i,e,r),bi(i,e,t,r),i.toNBT()};var ft=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vi(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function i(){if(this instanceof i){var o=[null];o.push.apply(o,arguments);var s=Function.bind.apply(e,o);return new s}return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var o=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:function(){return t[i]}})}),r}var ut={},sr={};function gi(t){var e=new ke(t),r=e.readChunk();if(r.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+r.id+"'";for(var i=xi(r.data),o=[],s=0;!e.eof()&&s<i.numTracks;s++){var n=e.readChunk();if(n.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+n.id+"'";var f=ki(n.data);o.push(f)}return{header:i,tracks:o}}function xi(t){var e=new ke(t),r=e.readUInt16(),i=e.readUInt16(),o={format:r,numTracks:i},s=e.readUInt16();return s&32768?(o.framesPerSecond=256-(s>>8),o.ticksPerFrame=s&255):o.ticksPerBeat=s,o}function ki(t){for(var e=new ke(t),r=[];!e.eof();){var i=s();r.push(i)}return r;var o;function s(){var n={};n.deltaTime=e.readVarInt();var f=e.readUInt8();if((f&240)===240)if(f===255){n.meta=!0;var u=e.readUInt8(),l=e.readVarInt();switch(u){case 0:if(n.type="sequenceNumber",l!==2)throw"Expected length for sequenceNumber event is 2, got "+l;return n.number=e.readUInt16(),n;case 1:return n.type="text",n.text=e.readString(l),n;case 2:return n.type="copyrightNotice",n.text=e.readString(l),n;case 3:return n.type="trackName",n.text=e.readString(l),n;case 4:return n.type="instrumentName",n.text=e.readString(l),n;case 5:return n.type="lyrics",n.text=e.readString(l),n;case 6:return n.type="marker",n.text=e.readString(l),n;case 7:return n.type="cuePoint",n.text=e.readString(l),n;case 32:if(n.type="channelPrefix",l!=1)throw"Expected length for channelPrefix event is 1, got "+l;return n.channel=e.readUInt8(),n;case 33:if(n.type="portPrefix",l!=1)throw"Expected length for portPrefix event is 1, got "+l;return n.port=e.readUInt8(),n;case 47:if(n.type="endOfTrack",l!=0)throw"Expected length for endOfTrack event is 0, got "+l;return n;case 81:if(n.type="setTempo",l!=3)throw"Expected length for setTempo event is 3, got "+l;return n.microsecondsPerBeat=e.readUInt24(),n;case 84:if(n.type="smpteOffset",l!=5)throw"Expected length for smpteOffset event is 5, got "+l;var x=e.readUInt8(),k={0:24,32:25,64:29,96:30};return n.frameRate=k[x&96],n.hour=x&31,n.min=e.readUInt8(),n.sec=e.readUInt8(),n.frame=e.readUInt8(),n.subFrame=e.readUInt8(),n;case 88:if(n.type="timeSignature",l!=2&&l!=4)throw"Expected length for timeSignature event is 4 or 2, got "+l;return n.numerator=e.readUInt8(),n.denominator=1<<e.readUInt8(),l===4?(n.metronome=e.readUInt8(),n.thirtyseconds=e.readUInt8()):(n.metronome=36,n.thirtyseconds=8),n;case 89:if(n.type="keySignature",l!=2)throw"Expected length for keySignature event is 2, got "+l;return n.key=e.readInt8(),n.scale=e.readUInt8(),n;case 127:return n.type="sequencerSpecific",n.data=e.readBytes(l),n;default:return n.type="unknownMeta",n.data=e.readBytes(l),n.metatypeByte=u,n}}else if(f==240){n.type="sysEx";var l=e.readVarInt();return n.data=e.readBytes(l),n}else if(f==247){n.type="endSysEx";var l=e.readVarInt();return n.data=e.readBytes(l),n}else throw"Unrecognised MIDI event type byte: "+f;else{var p;if(f&128)p=e.readUInt8(),o=f;else{if(o===null)throw"Running status byte encountered before status byte";p=f,f=o,n.running=!0}var w=f>>4;switch(n.channel=f&15,w){case 8:return n.type="noteOff",n.noteNumber=p,n.velocity=e.readUInt8(),n;case 9:var B=e.readUInt8();return n.type=B===0?"noteOff":"noteOn",n.noteNumber=p,n.velocity=B,B===0&&(n.byte9=!0),n;case 10:return n.type="noteAftertouch",n.noteNumber=p,n.amount=e.readUInt8(),n;case 11:return n.type="controller",n.controllerType=p,n.value=e.readUInt8(),n;case 12:return n.type="programChange",n.programNumber=p,n;case 13:return n.type="channelAftertouch",n.amount=p,n;case 14:return n.type="pitchBend",n.value=p+(e.readUInt8()<<7)-8192,n;default:throw"Unrecognised MIDI event type: "+w}}}}function ke(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}ke.prototype.eof=function(){return this.pos>=this.bufferLen};ke.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};ke.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};ke.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};ke.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};ke.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8();return(t<<16)+(e<<8)+r};ke.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};ke.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8(),i=this.readUInt8();return(t<<24)+(e<<16)+(r<<8)+i};ke.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};ke.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};ke.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};ke.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),r=this.readBytes(e);return{id:t,length:e,data:r}};var wi=gi;function Ii(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var r=t.header||{},i=t.tracks||[],o,s=i.length,n=new le;for(_i(n,r,s),o=0;o<s;o++)Ti(n,i[o],e);return n.buffer}function _i(t,e,r){var i=e.format==null?1:e.format,o=128;e.timeDivision?o=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?o=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(o=e.ticksPerBeat&32767);var s=new le;s.writeUInt16(i),s.writeUInt16(r),s.writeUInt16(o),t.writeChunk("MThd",s.buffer)}function Ti(t,e,r){var i=new le,o,s=e.length,n=null;for(o=0;o<s;o++)(r.running===!1||!r.running&&!e[o].running)&&(n=null),n=Si(i,e[o],n,r.useByte9ForNoteOff);t.writeChunk("MTrk",i.buffer)}function Si(t,e,r,i){var o=e.type,s=e.deltaTime,n=e.text||"",f=e.data||[],u=null;switch(t.writeVarInt(s),o){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(n.length),t.writeString(n);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(n.length),t.writeString(n);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(n.length),t.writeString(n);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(n.length),t.writeString(n);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(n.length),t.writeString(n);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(n.length),t.writeString(n);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(n.length),t.writeString(n);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var l={24:0,25:32,29:64,30:96},x=e.hour&31|l[e.frameRate];t.writeUInt8(x),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var k=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(k),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(f.length),t.writeBytes(f);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(f.length),t.writeBytes(f));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(f.length),t.writeBytes(f);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(f.length),t.writeBytes(f);break;case"noteOff":var p=i!==!1&&e.byte9||i&&e.velocity==0?144:128;u=p|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==r&&t.writeUInt8(u);var w=8192+e.value,B=w&127,U=w>>7&127;t.writeUInt8(B),t.writeUInt8(U);break;default:throw"Unrecognized event type: "+o}return u}function le(){this.buffer=[]}le.prototype.writeUInt8=function(t){this.buffer.push(t&255)};le.prototype.writeInt8=le.prototype.writeUInt8;le.prototype.writeUInt16=function(t){var e=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(r)};le.prototype.writeInt16=le.prototype.writeUInt16;le.prototype.writeUInt24=function(t){var e=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(i)};le.prototype.writeInt24=le.prototype.writeUInt24;le.prototype.writeUInt32=function(t){var e=t>>24&255,r=t>>16&255,i=t>>8&255,o=t&255;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(i),this.writeUInt8(o)};le.prototype.writeInt32=le.prototype.writeUInt32;le.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};le.prototype.writeString=function(t){var e,r=t.length,i=[];for(e=0;e<r;e++)i.push(t.codePointAt(e));this.writeBytes(i)};le.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,r=[];for(r.push(e&127),e>>=7;e;){var i=e&127|128;r.push(i),e>>=7}this.writeBytes(r.reverse())}};le.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var Bi=Ii;sr.parseMidi=wi;sr.writeMidi=Bi;var Yt={},nt={};Object.defineProperty(nt,"__esModule",{value:!0});nt.insert=nt.search=void 0;function _n(t,e,r){r===void 0&&(r="ticks");var i=0,o=t.length,s=o;if(o>0&&t[o-1][r]<=e)return o-1;for(;i<s;){var n=Math.floor(i+(s-i)/2),f=t[n],u=t[n+1];if(f[r]===e){for(var l=n;l<t.length;l++){var x=t[l];x[r]===e&&(n=l)}return n}else{if(f[r]<e&&u[r]>e)return n;f[r]>e?s=n:f[r]<e&&(i=n+1)}}return-1}nt.search=_n;function Oi(t,e,r){if(r===void 0&&(r="ticks"),t.length){var i=_n(t,e[r],r);t.splice(i+1,0,e)}else t.push(e)}nt.insert=Oi;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=nt,r=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var i=function(){function o(s){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",r.set(this,480),s){r.set(this,s.header.ticksPerBeat),s.tracks.forEach(function(u){u.forEach(function(l){l.meta&&(l.type==="timeSignature"?n.timeSignatures.push({ticks:l.absoluteTime,timeSignature:[l.numerator,l.denominator]}):l.type==="setTempo"?n.tempos.push({bpm:6e7/l.microsecondsPerBeat,ticks:l.absoluteTime}):l.type==="keySignature"&&n.keySignatures.push({key:t.keySignatureKeys[l.key+7],scale:l.scale===0?"major":"minor",ticks:l.absoluteTime}))})});var f=0;s.tracks[0].forEach(function(u){f+=u.deltaTime,u.meta&&(u.type==="trackName"?n.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&n.meta.push({text:u.text,ticks:f,type:u.type}))}),this.update()}}return o.prototype.update=function(){var s=this,n=0,f=0;this.tempos.sort(function(u,l){return u.ticks-l.ticks}),this.tempos.forEach(function(u,l){var x=l>0?s.tempos[l-1].bpm:s.tempos[0].bpm,k=u.ticks/s.ppq-f,p=60/x*k;u.time=p+n,n=u.time,f+=k}),this.timeSignatures.sort(function(u,l){return u.ticks-l.ticks}),this.timeSignatures.forEach(function(u,l){var x=l>0?s.timeSignatures[l-1]:s.timeSignatures[0],k=(u.ticks-x.ticks)/s.ppq,p=k/x.timeSignature[0]/(x.timeSignature[1]/4);x.measures=x.measures||0,u.measures=p+x.measures})},o.prototype.ticksToSeconds=function(s){var n=(0,e.search)(this.tempos,s);if(n!==-1){var f=this.tempos[n],u=f.time,l=(s-f.ticks)/this.ppq;return u+60/f.bpm*l}else{var x=s/this.ppq;return 60/120*x}},o.prototype.ticksToMeasures=function(s){var n=(0,e.search)(this.timeSignatures,s);if(n!==-1){var f=this.timeSignatures[n],u=(s-f.ticks)/this.ppq;return f.measures+u/(f.timeSignature[0]/f.timeSignature[1])/4}else return s/this.ppq/4},Object.defineProperty(o.prototype,"ppq",{get:function(){return r.get(this)},enumerable:!1,configurable:!0}),o.prototype.secondsToTicks=function(s){var n=(0,e.search)(this.tempos,s,"time");if(n!==-1){var f=this.tempos[n],u=f.time,l=s-u,x=l/(60/f.bpm);return Math.round(f.ticks+x*this.ppq)}else{var k=s/.5;return Math.round(k*this.ppq)}},o.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(s){return{bpm:s.bpm,ticks:s.ticks}}),timeSignatures:this.timeSignatures}},o.prototype.fromJSON=function(s){this.name=s.name,this.tempos=s.tempos.map(function(n){return Object.assign({},n)}),this.timeSignatures=s.timeSignatures.map(function(n){return Object.assign({},n)}),this.keySignatures=s.keySignatures.map(function(n){return Object.assign({},n)}),this.meta=s.meta.map(function(n){return Object.assign({},n)}),r.set(this,s.ppq),this.update()},o.prototype.setTempo=function(s){this.tempos=[{bpm:s,ticks:0}],this.update()},o}();t.Header=i})(Yt);var _t={},Lr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(o,s){return o[t.controlChangeNames[s]]=s,o},{});var e=new WeakMap,r=new WeakMap,i=function(){function o(s,n){e.set(this,n),r.set(this,s.controllerType),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(o.prototype,"number",{get:function(){return r.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"time",{get:function(){var s=e.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var n=e.get(this);this.ticks=n.secondsToTicks(s)},enumerable:!1,configurable:!0}),o.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},o}();t.ControlChange=i})(Lr);var cr={};Object.defineProperty(cr,"__esModule",{value:!0});cr.createControlChanges=void 0;var Vt=Lr;function Ui(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(Vt.controlChangeIds.hasOwnProperty(e))return t[Vt.controlChangeIds[e]]},set:function(t,e,r){return Vt.controlChangeIds.hasOwnProperty(e)?t[Vt.controlChangeIds[e]]=r:t[e]=r,!0}})}cr.createControlChanges=Ui;var fr={};Object.defineProperty(fr,"__esModule",{value:!0});fr.PitchBend=void 0;var Br=new WeakMap,Ei=function(){function t(e,r){Br.set(this,r),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=Br.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var r=Br.get(this);this.ticks=r.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();fr.PitchBend=Ei;var ur={},Ze={};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.DrumKitByPatchID=Ze.InstrumentFamilyByID=Ze.instrumentByPatchID=void 0;Ze.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Ze.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Ze.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(ur,"__esModule",{value:!0});ur.Instrument=void 0;var qt=Ze,ln=new WeakMap,Ni=function(){function t(e,r){if(this.number=0,ln.set(this,r),this.number=0,e){var i=e.find(function(o){return o.type==="programChange"});i&&(this.number=i.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?qt.DrumKitByPatchID[this.number]:qt.instrumentByPatchID[this.number]},set:function(e){var r=qt.instrumentByPatchID.indexOf(e);r!==-1&&(this.number=r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":qt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=ln.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();ur.Instrument=Ni;var lr={};Object.defineProperty(lr,"__esModule",{value:!0});lr.Note=void 0;function Ci(t){var e=Math.floor(t/12)-1;return Tn(t)+e.toString()}function Tn(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r=t%12;return e[r]}function Fi(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var Mi=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(r){var i=t.exec(r),o=i[1],s=i[2],n=e[o.toLowerCase()];return n+(parseInt(s,10)+1)*12}}(),ct=new WeakMap,Ai=function(){function t(e,r,i){ct.set(this,i),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=r.velocity,this.ticks=e.ticks,this.durationTicks=r.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return Ci(this.midi)},set:function(e){this.midi=Mi(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var r=e-this.octave;this.midi+=r*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return Tn(this.midi)},set:function(e){this.midi=12*(this.octave+1)+Fi(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=ct.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var r=ct.get(this),i=r.secondsToTicks(this.time+e);this.durationTicks=i-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=ct.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var r=ct.get(this);this.ticks=r.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=ct.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();lr.Note=Ai;Object.defineProperty(_t,"__esModule",{value:!0});_t.Track=void 0;var Or=nt,Pi=Lr,Di=cr,Li=fr,hn=ur,Ri=lr,Jt=new WeakMap,ji=function(){function t(e,r){var i=this;if(this.name="",this.notes=[],this.controlChanges=(0,Di.createControlChanges)(),this.pitchBends=[],Jt.set(this,r),e){var o=e.find(function(p){return p.type==="trackName"});this.name=o?o.text:""}if(this.instrument=new hn.Instrument(e,this),this.channel=0,e){for(var s=e.filter(function(p){return p.type==="noteOn"}),n=e.filter(function(p){return p.type==="noteOff"}),f=function(){var p=s.shift();u.channel=p.channel;var w=n.findIndex(function(U){return U.noteNumber===p.noteNumber&&U.absoluteTime>=p.absoluteTime});if(w!==-1){var B=n.splice(w,1)[0];u.addNote({durationTicks:B.absoluteTime-p.absoluteTime,midi:p.noteNumber,noteOffVelocity:B.velocity/127,ticks:p.absoluteTime,velocity:p.velocity/127})}},u=this;s.length;)f();var l=e.filter(function(p){return p.type==="controller"});l.forEach(function(p){i.addCC({number:p.controllerType,ticks:p.absoluteTime,value:p.value/127})});var x=e.filter(function(p){return p.type==="pitchBend"});x.forEach(function(p){i.addPitchBend({ticks:p.absoluteTime,value:p.value/Math.pow(2,13)})});var k=e.find(function(p){return p.type==="endOfTrack"});this.endOfTrackTicks=k!==void 0?k.absoluteTime:void 0}}return t.prototype.addNote=function(e){var r=Jt.get(this),i=new Ri.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},r);return Object.assign(i,e),(0,Or.insert)(this.notes,i,"ticks"),this},t.prototype.addCC=function(e){var r=Jt.get(this),i=new Pi.ControlChange({controllerType:e.number},r);return delete e.number,Object.assign(i,e),Array.isArray(this.controlChanges[i.number])||(this.controlChanges[i.number]=[]),(0,Or.insert)(this.controlChanges[i.number],i,"ticks"),this},t.prototype.addPitchBend=function(e){var r=Jt.get(this),i=new Li.PitchBend({},r);return Object.assign(i,e),(0,Or.insert)(this.pitchBends,i,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,r=0;r<this.notes.length-1;r++){var i=this.notes[r].time+this.notes[r].duration;e<i&&(e=i)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,r=0;r<this.notes.length-1;r++){var i=this.notes[r].ticks+this.notes[r].durationTicks;e<i&&(e=i)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var r=this;this.name=e.name,this.channel=e.channel,this.instrument=new hn.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var i in e.controlChanges)e.controlChanges[i]&&e.controlChanges[i].forEach(function(o){r.addCC({number:o.number,ticks:o.ticks,value:o.value})});e.notes.forEach(function(o){r.addNote({durationTicks:o.durationTicks,midi:o.midi,ticks:o.ticks,velocity:o.velocity})})},t.prototype.toJSON=function(){for(var e={},r=0;r<127;r++)this.controlChanges.hasOwnProperty(r)&&(e[r]=this.controlChanges[r].map(function(o){return o.toJSON()}));var i={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(o){return o.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(o){return o.toJSON()})};return this.endOfTrackTicks!==void 0&&(i.endOfTrackTicks=this.endOfTrackTicks),i},t}();_t.Track=ji;var hr={};function Hi(t){var e=[];return Sn(t,e),e}function Sn(t,e){for(var r=0;r<t.length;r++){var i=t[r];Array.isArray(i)?Sn(i,e):e.push(i)}}const Vi=Object.freeze(Object.defineProperty({__proto__:null,flatten:Hi},Symbol.toStringTag,{value:"Module"})),qi=vi(Vi);var $e=ft&&ft.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,o=e.length,s;i<o;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))};Object.defineProperty(hr,"__esModule",{value:!0});hr.encode=void 0;var Ji=sr,Gi=Yt,Wi=qi;function zi(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function Yi(t){return(0,Wi.flatten)(t.notes.map(function(e){return zi(e,t.channel)}))}function Xi(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Ki(t){for(var e=[],r=0;r<127;r++)t.controlChanges.hasOwnProperty(r)&&t.controlChanges[r].forEach(function(i){e.push(Xi(i,t.channel))});return e}function $i(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Zi(t){var e=[];return t.pitchBends.forEach(function(r){e.push($i(r,t.channel))}),e}function Qi(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function ea(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function ta(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function ra(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function na(t){var e=Gi.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function ia(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function aa(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:$e([$e($e($e($e([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(r){return na(r)}),!0),t.header.meta.map(function(r){return ia(r)}),!0),t.header.tempos.map(function(r){return ta(r)}),!0),t.header.timeSignatures.map(function(r){return ra(r)}),!0)],t.tracks.map(function(r){return $e($e($e([ea(r.name),Qi(r)],Yi(r),!0),Ki(r),!0),Zi(r),!0)}),!0)};return e.tracks=e.tracks.map(function(r){r=r.sort(function(o,s){return o.absoluteTime-s.absoluteTime});var i=0;return r.forEach(function(o){o.deltaTime=o.absoluteTime-i,i=o.absoluteTime,delete o.absoluteTime}),r.push({deltaTime:0,meta:!0,type:"endOfTrack"}),r}),new Uint8Array((0,Ji.writeMidi)(e))}hr.encode=aa;(function(t){var e=ft&&ft.__awaiter||function(k,p,w,B){function U(I){return I instanceof w?I:new w(function(G){G(I)})}return new(w||(w=Promise))(function(I,G){function W(S){try{m(B.next(S))}catch(E){G(E)}}function oe(S){try{m(B.throw(S))}catch(E){G(E)}}function m(S){S.done?I(S.value):U(S.value).then(W,oe)}m((B=B.apply(k,p||[])).next())})},r=ft&&ft.__generator||function(k,p){var w={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},B,U,I,G;return G={next:W(0),throw:W(1),return:W(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function W(m){return function(S){return oe([m,S])}}function oe(m){if(B)throw new TypeError("Generator is already executing.");for(;w;)try{if(B=1,U&&(I=m[0]&2?U.return:m[0]?U.throw||((I=U.return)&&I.call(U),0):U.next)&&!(I=I.call(U,m[1])).done)return I;switch(U=0,I&&(m=[m[0]&2,I.value]),m[0]){case 0:case 1:I=m;break;case 4:return w.label++,{value:m[1],done:!1};case 5:w.label++,U=m[1],m=[0];continue;case 7:m=w.ops.pop(),w.trys.pop();continue;default:if(I=w.trys,!(I=I.length>0&&I[I.length-1])&&(m[0]===6||m[0]===2)){w=0;continue}if(m[0]===3&&(!I||m[1]>I[0]&&m[1]<I[3])){w.label=m[1];break}if(m[0]===6&&w.label<I[1]){w.label=I[1],I=m;break}if(I&&w.label<I[2]){w.label=I[2],w.ops.push(m);break}I[2]&&w.ops.pop(),w.trys.pop();continue}m=p.call(k,w)}catch(S){m=[6,S],U=0}finally{B=I=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var i=sr,o=Yt,s=_t,n=hr,f=function(){function k(p){var w=this,B=null;if(p){var U=p instanceof ArrayBuffer?new Uint8Array(p):p;B=(0,i.parseMidi)(U),B.tracks.forEach(function(I){var G=0;I.forEach(function(W){G+=W.deltaTime,W.absoluteTime=G})}),B.tracks=x(B.tracks)}this.header=new o.Header(B),this.tracks=[],p&&(this.tracks=B.tracks.map(function(I){return new s.Track(I,w.header)}),B.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return k.fromUrl=function(p){return e(this,void 0,void 0,function(){var w,B;return r(this,function(U){switch(U.label){case 0:return[4,fetch(p)];case 1:return w=U.sent(),w.ok?[4,w.arrayBuffer()]:[3,3];case 2:return B=U.sent(),[2,new k(B)];case 3:throw new Error("Could not load '".concat(p,"'"))}})})},Object.defineProperty(k.prototype,"name",{get:function(){return this.header.name},set:function(p){this.header.name=p},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"duration",{get:function(){var p=this.tracks.map(function(w){return w.duration});return Math.max.apply(Math,p)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"durationTicks",{get:function(){var p=this.tracks.map(function(w){return w.durationTicks});return Math.max.apply(Math,p)},enumerable:!1,configurable:!0}),k.prototype.addTrack=function(){var p=new s.Track(void 0,this.header);return this.tracks.push(p),p},k.prototype.toArray=function(){return(0,n.encode)(this)},k.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(p){return p.toJSON()})}},k.prototype.fromJSON=function(p){var w=this;this.header=new o.Header,this.header.fromJSON(p.header),this.tracks=p.tracks.map(function(B){var U=new s.Track(void 0,w.header);return U.fromJSON(B),U})},k.prototype.clone=function(){var p=new k;return p.fromJSON(this.toJSON()),p},k}();t.Midi=f;var u=_t;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return u.Track}});var l=Yt;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return l.Header}});function x(k){for(var p=[],w=0;w<k.length;w++)for(var B=p.length,U=new Map,I=Array(16).fill(0),G=0,W=k[w];G<W.length;G++){var oe=W[G],m=B,S=oe.channel;if(S!==void 0){oe.type==="programChange"&&(I[S]=oe.programNumber);var E=I[S],H="".concat(E," ").concat(S);U.has(H)?m=U.get(H):(m=B+U.size,U.set(H,m))}p[m]||p.push([]),p[m].push(oe)}return p}})(ut);const Gt=[6,30,54,78,102,126],oa=t=>{const e=new ut.Midi;for(let r=0;r<Gt.length-1;r++){const i=54-Gt[r],o=new ut.Midi;t.tracks.forEach(s=>{const n=new ut.Track([],new ut.Header);s.notes.forEach(f=>{Gt[r]<f.midi&&f.midi<Gt[r+1]&&(f.midi+=i,n.addNote(f))}),o.tracks.push(n)}),e.tracks.push(o.tracks[0])}return e};var Ar={},sa={get exports(){return Ar},set exports(t){Ar=t}},Tt={},ca={get exports(){return Tt},set exports(t){Tt=t}};(function(){var t=[],e=3988292384;function r(){var n,f,u;for(f=0;f<256;f+=1){for(n=f,u=0;u<8;u+=1)n&1?n=e^n>>>1:n=n>>>1;t[f]=n>>>0}}function i(n){return Array.prototype.map.call(n,function(f){return f.charCodeAt(0)})}function o(n){var f=-1,u,l,x,k;for(u=0,x=n.length;u<x;u+=1){for(k=(f^n[u])&255,l=0;l<8;l+=1)(k&1)===1?k=k>>>1^e:k=k>>>1;f=f>>>8^k}return f^-1}function s(n,f){var u,l,x;if(!((typeof s.crc>"u"||!f||!n)&&(s.crc=-1,!n))){for(u=s.crc,l=0,x=n.length;l<x;l+=1)u=u>>>8^t[(u^n[l])&255];return s.crc=u,u^-1}}r(),ca.exports=function(u,f){var u=typeof u=="string"?i(u):u,l=f?o(u):s(u);return(l>>>0).toString(16)},Tt.direct=o,Tt.table=s})();var Pr={},fa={get exports(){return Pr},set exports(t){Pr=t}},Dr={},ua={get exports(){return Dr},set exports(t){Dr=t}};(function(){var t=32768,e=0,r=1,i=2,o=9,s=6,n,f,u=null,l,x,k,p,w,B,U,I,G,W,oe,m,S,E,H,re=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],fe=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],_e=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],Re=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Fe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Me=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function ht(){this.next=null,this.list=null}function it(){this.e=0,this.b=0,this.n=0,this.t=null}function Je(D,L,M,h,v,C){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var Te,se=[],q,Q,N,R,g,_,Se,Be=[],ce,me,Oe,z=new it,ge=[],Ue=[],ne,ee=[],be,de,pe,ue,J;for(J=this.root=null,g=0;g<this.BMAX+1;g++)se[g]=0;for(g=0;g<this.BMAX+1;g++)Be[g]=0;for(g=0;g<this.BMAX;g++)ge[g]=null;for(g=0;g<this.N_MAX;g++)Ue[g]=0;for(g=0;g<this.BMAX+1;g++)ee[g]=0;q=L>256?D[256]:this.BMAX,ce=D,me=0,g=L;do se[ce[me]]++,me++;while(--g>0);if(se[0]===L){this.root=null,this.m=0,this.status=0;return}for(_=1;_<=this.BMAX&&se[_]===0;_++);for(Se=_,C<_&&(C=_),g=this.BMAX;g!==0&&se[g]===0;g--);for(N=g,C>g&&(C=g),de=1<<_;_<g;_++,de<<=1)if((de-=se[_])<0){this.status=2,this.m=C;return}if((de-=se[g])<0){this.status=2,this.m=C;return}for(se[g]+=de,ee[1]=_=0,ce=se,me=1,be=2;--g>0;)ee[be++]=_+=ce[me++];ce=D,me=0,g=0;do(_=ce[me++])!==0&&(Ue[ee[_]++]=g);while(++g<L);for(L=ee[N],ee[0]=g=0,ce=Ue,me=0,R=-1,ne=Be[0]=0,Oe=null,pe=0,null;Se<=N;Se++)for(Te=se[Se];Te-- >0;){for(;Se>ne+Be[1+R];){if(ne+=Be[1+R],R++,pe=(pe=N-ne)>C?C:pe,(Q=1<<(_=Se-ne))>Te+1)for(Q-=Te+1,be=Se;++_<pe&&!((Q<<=1)<=se[++be]);)Q-=se[be];for(ne+_>q&&ne<q&&(_=q-ne),pe=1<<_,Be[1+R]=_,Oe=[],ue=0;ue<pe;ue++)Oe[ue]=new it;J?J=J.next=new ht:J=this.root=new ht,J.next=null,J.list=Oe,ge[R]=Oe,R>0&&(ee[R]=g,z.b=Be[R],z.e=16+_,z.t=Oe,_=(g&(1<<ne)-1)>>ne-Be[R],ge[R-1][_].e=z.e,ge[R-1][_].b=z.b,ge[R-1][_].n=z.n,ge[R-1][_].t=z.t)}for(z.b=Se-ne,me>=L?z.e=99:ce[me]<M?(z.e=ce[me]<256?16:15,z.n=ce[me++]):(z.e=v[ce[me]-M],z.n=h[ce[me++]-M]),Q=1<<Se-ne,_=g>>ne;_<pe;_+=Q)Oe[_].e=z.e,Oe[_].b=z.b,Oe[_].n=z.n,Oe[_].t=z.t;for(_=1<<Se-1;g&_;_>>=1)g^=_;for(g^=_;(g&(1<<ne)-1)!==ee[R];)ne-=Be[R],R--}this.m=Be[1],this.status=de!==0&&N!==1?1:0}function Ge(){return E.length===H?-1:E[H++]&255}function P(D){for(;w<D;)p|=Ge()<<w,w+=8}function te(D){return p&re[D]}function Z(D){p>>=D,w-=D}function Ae(D,L,M){var h,v,C;if(M===0)return 0;for(C=0;;){for(P(m),v=W.list[te(m)],h=v.e;h>16;){if(h===99)return-1;Z(v.b),h-=16,P(h),v=v.t[te(h)],h=v.e}if(Z(v.b),h===16){if(f&=t-1,D[L+C++]=n[f++]=v.n,C===M)return M;continue}if(h===15)break;for(P(h),I=v.n+te(h),Z(h),P(S),v=oe.list[te(S)],h=v.e;h>16;){if(h===99)return-1;Z(v.b),h-=16,P(h),v=v.t[te(h)],h=v.e}for(Z(v.b),P(h),G=f-v.n-te(h),Z(h);I>0&&C<M;)I--,G&=t-1,f&=t-1,D[L+C++]=n[f++]=n[G++];if(C===M)return M}return B=-1,C}function ve(D,L,M){var h;if(h=w&7,Z(h),P(16),h=te(16),Z(16),P(16),h!==(~p&65535))return-1;for(Z(16),I=h,h=0;I>0&&h<M;)I--,f&=t-1,P(8),D[L+h++]=n[f++]=te(8),Z(8);return I===0&&(B=-1),h}function he(D,L,M){if(!u){var h,v=[],C;for(h=0;h<144;h++)v[h]=8;for(null;h<256;h++)v[h]=9;for(null;h<280;h++)v[h]=7;for(null;h<288;h++)v[h]=8;if(x=7,C=new Je(v,288,257,fe,_e,x),C.status!==0)return console.error("HufBuild error: "+C.status),-1;for(u=C.root,x=C.m,h=0;h<30;h++)v[h]=5;if(k=5,C=new Je(v,30,0,Re,Fe,k),C.status>1)return u=null,console.error("HufBuild error: "+C.status),-1;l=C.root,k=C.m}return W=u,oe=l,m=x,S=k,Ae(D,L,M)}function at(D,L,M){var h,v,C,Te,se,q,Q,N,R=[],g;for(h=0;h<286+30;h++)R[h]=0;if(P(5),Q=257+te(5),Z(5),P(5),N=1+te(5),Z(5),P(4),q=4+te(4),Z(4),Q>286||N>30)return-1;for(v=0;v<q;v++)P(3),R[Me[v]]=te(3),Z(3);for(null;v<19;v++)R[Me[v]]=0;if(m=7,g=new Je(R,19,19,null,null,m),g.status!==0)return-1;for(W=g.root,m=g.m,Te=Q+N,h=C=0;h<Te;)if(P(m),se=W.list[te(m)],v=se.b,Z(v),v=se.n,v<16)R[h++]=C=v;else if(v===16){if(P(2),v=3+te(2),Z(2),h+v>Te)return-1;for(;v-- >0;)R[h++]=C}else if(v===17){if(P(3),v=3+te(3),Z(3),h+v>Te)return-1;for(;v-- >0;)R[h++]=0;C=0}else{if(P(7),v=11+te(7),Z(7),h+v>Te)return-1;for(;v-- >0;)R[h++]=0;C=0}if(m=o,g=new Je(R,Q,257,fe,_e,m),m===0&&(g.status=1),g.status!==0&&g.status!==1)return-1;for(W=g.root,m=g.m,h=0;h<N;h++)R[h]=R[h+Q];return S=s,g=new Je(R,N,0,Re,Fe,S),oe=g.root,S=g.m,S===0&&Q>257||g.status!==0?-1:Ae(D,L,M)}function K(){n||(n=[]),f=0,p=0,w=0,B=-1,U=!1,I=G=0,W=null}function dt(D,L,M){var h,v;for(h=0;h<M;){if(U&&B===-1)return h;if(I>0){if(B!==e)for(;I>0&&h<M;)I--,G&=t-1,f&=t-1,D[L+h++]=n[f++]=n[G++];else{for(;I>0&&h<M;)I--,f&=t-1,P(8),D[L+h++]=n[f++]=te(8),Z(8);I===0&&(B=-1)}if(h===M)return h}if(B===-1){if(U)break;P(1),te(1)!==0&&(U=!0),Z(1),P(2),B=te(2),Z(2),W=null,I=0}switch(B){case e:v=ve(D,L+h,M-h);break;case r:W?v=Ae(D,L+h,M-h):v=he(D,L+h,M-h);break;case i:W?v=Ae(D,L+h,M-h):v=at(D,L+h,M-h);break;default:v=-1;break}if(v===-1)return U?0:-1;h+=v}return h}function pt(D){var L=[],M;K(),E=D,H=0;do M=dt(L,L.length,1024);while(M>0);return E=null,L}ua.exports=pt})();var Xt={},la={get exports(){return Xt},set exports(t){Xt=t}};(function(){var t=32768,e=0,r=1,i=2,o=6,s=1024*8,n=2*t,f=3,u=258,l=8192,x=15,k=l,p=1<<x,w=p-1,B=t-1,U=0,I=4096,G=u+f+1,W=t-G,oe=1,m=15,S=7,E=29,H=256,re=256,fe=H+1+E,_e=30,Re=19,Fe=16,Me=17,ht=18,it=2*fe+1,Je=parseInt((x+f-1)/f,10),Ge,P,te,Z,Ae=null,ve,he,at,K,dt,pt,D,L,M,h,v,C,Te,se,q,Q,N,R,g,_,Se,Be,ce,me,Oe,z,ge,Ue,ne,ee,be,de,pe,ue,J,We,ot,De,mt,bt,dr,Et,Nt,ze,Ct,pr,yt,Ft,st,Mt,At,mr;function vt(){this.fc=0,this.dl=0}function br(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function je(a,c,y,d){this.good_length=a,this.max_lazy=c,this.nice_length=y,this.max_chain=d}function Bn(){this.next=null,this.len=0,this.ptr=[],this.off=0}var yr=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],gt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],On=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Rr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Pt=[new je(0,0,0,0),new je(4,4,8,4),new je(4,5,16,8),new je(4,6,32,32),new je(4,4,16,16),new je(8,16,32,32),new je(8,16,128,128),new je(8,32,128,256),new je(32,128,258,1024),new je(32,258,258,4096)];function Un(a){var c;if(a?a<1?a=1:a>9&&(a=9):a=o,ce=a,Z=!1,g=!1,Ae===null){for(Ge=P=te=null,Ae=[],K=[],dt=[],pt=[],D=[],z=[],c=0;c<it;c++)z[c]=new vt;for(ge=[],c=0;c<2*_e+1;c++)ge[c]=new vt;for(Ue=[],c=0;c<fe+2;c++)Ue[c]=new vt;for(ne=[],c=0;c<_e;c++)ne[c]=new vt;for(ee=[],c=0;c<2*Re+1;c++)ee[c]=new vt;be=new br,de=new br,pe=new br,ue=[],J=[],De=[],mt=[],bt=[],dr=[],Et=[],Nt=[]}}function En(a){a.next=Ge,Ge=a}function Nn(){var a;return Ge!==null?(a=Ge,Ge=Ge.next):a=new Bn,a.next=null,a.len=a.off=0,a}function jr(a){return D[t+a]}function Hr(a,c){return D[t+a]=c}function Dt(a){Ae[he+ve++]=a,he+ve===s&&Hn()}function Lt(a){a&=65535,he+ve<s-2?(Ae[he+ve++]=a&255,Ae[he+ve++]=a>>>8):(Dt(a&255),Dt(a>>>8))}function Rt(){v=(v<<Je^K[N+f-1]&255)&w,C=jr(v),D[N&B]=C,Hr(v,N)}function Ye(a,c){Ee(c[a].fc,c[a].dl)}function Vr(a){return(a<256?bt[a]:bt[256+(a>>7)])&255}function qr(a,c,y){return a[c].fc<a[y].fc||a[c].fc===a[y].fc&&De[c]<=De[y]}function Jr(a,c,y){var d;for(d=0;d<y&&mr<At.length;d++)a[c+d]=At[mr++]&255;return d}function Cn(){var a;for(a=0;a<p;a++)D[t+a]=0;if(Be=Pt[ce].max_lazy,me=Pt[ce].good_length,Oe=Pt[ce].nice_length,Se=Pt[ce].max_chain,N=0,h=0,_=Jr(K,0,2*t),_<=0){g=!0,_=0;return}for(g=!1;_<G&&!g;)vr();for(v=0,a=0;a<f-1;a++)v=(v<<Je^K[a]&255)&w}function Gr(a){var c=Se,y=N,d,b,T=Q,j=N>W?N-W:U,V=N+u,A=K[y+T-1],xe=K[y+T],$,Ke;Q>=me&&(c>>=2);do if(d=a,!(K[d+T]!==xe||K[d+T-1]!==A||K[d]!==K[y]||K[++d]!==K[y+1])){for(y+=2,d++;y<V;){for(Ke=!1,$=0;$<8;$+=1)if(y+=1,d+=1,K[y]!==K[d]){Ke=!0;break}if(Ke)break}if(b=u-(V-y),y=V-u,b>T){if(R=a,T=b,b>=Oe)break;A=K[y+T-1],xe=K[y+T]}}while((a=D[a&B])>j&&--c!==0);return T}function vr(){var a,c,y=n-_-N;if(y===-1)y--;else if(N>=t+W){for(a=0;a<t;a++)K[a]=K[a+t];for(R-=t,N-=t,h-=t,a=0;a<p;a++)c=jr(a),Hr(a,c>=t?c-t:U);for(a=0;a<t;a++)c=D[a],D[a]=c>=t?c-t:U;y+=t}g||(a=Jr(K,N+_,y),a<=0?g=!0:_+=a)}function Fn(){for(;_!==0&&P===null;){var a;if(Rt(),C!==U&&N-C<=W&&(q=Gr(C),q>_&&(q=_)),q>=f)if(a=xt(N-R,q-f),_-=q,q<=Be){q--;do N++,Rt();while(--q!==0);N++}else N+=q,q=0,v=K[N]&255,v=(v<<Je^K[N+1]&255)&w;else a=xt(0,K[N]&255),_--,N++;for(a&&(jt(0),h=N);_<G&&!g;)vr()}}function Mn(){for(;_!==0&&P===null;){if(Rt(),Q=q,Te=R,q=f-1,C!==U&&Q<Be&&N-C<=W&&(q=Gr(C),q>_&&(q=_),q===f&&N-R>I&&q--),Q>=f&&q<=Q){var a;a=xt(N-1-Te,Q-f),_-=Q-1,Q-=2;do N++,Rt();while(--Q!==0);se=!1,q=f-1,N++,a&&(jt(0),h=N)}else se?(xt(0,K[N-1]&255)&&(jt(0),h=N),N++,_--):(se=!0,N++,_--);for(;_<G&&!g;)vr()}}function An(){g||(L=0,M=0,Dn(),Cn(),P=null,ve=0,he=0,ce<=3?(Q=f-1,q=0):(q=f-1,se=!1),at=!1)}function Pn(a,c,y){var d;return!Z&&(An(),Z=!0,_===0)?(at=!0,0):(d=Wr(a,c,y),d===y?y:at?d:(ce<=3?Fn():Mn(),_===0&&(se&&xt(0,K[N-1]&255),jt(1),at=!0),d+Wr(a,d+c,y-d)))}function Wr(a,c,y){var d,b,T;for(d=0;P!==null&&d<y;){for(b=y-d,b>P.len&&(b=P.len),T=0;T<b;T++)a[c+d+T]=P.ptr[P.off+T];if(P.off+=b,P.len-=b,d+=b,P.len===0){var j;j=P,P=P.next,En(j)}}if(d===y)return d;if(he<ve){for(b=y-d,b>ve-he&&(b=ve-he),T=0;T<b;T++)a[c+d+T]=Ae[he+T];he+=b,d+=b,ve===he&&(ve=he=0)}return d}function Dn(){var a,c,y,d,b;if(ne[0].dl===0){for(be.dyn_tree=z,be.static_tree=Ue,be.extra_bits=yr,be.extra_base=H+1,be.elems=fe,be.max_length=m,be.max_code=0,de.dyn_tree=ge,de.static_tree=ne,de.extra_bits=gt,de.extra_base=0,de.elems=_e,de.max_length=m,de.max_code=0,pe.dyn_tree=ee,pe.static_tree=null,pe.extra_bits=On,pe.extra_base=0,pe.elems=Re,pe.max_length=S,pe.max_code=0,y=0,d=0;d<E-1;d++)for(dr[d]=y,a=0;a<1<<yr[d];a++)mt[y++]=d;for(mt[y-1]=d,b=0,d=0;d<16;d++)for(Et[d]=b,a=0;a<1<<gt[d];a++)bt[b++]=d;for(b>>=7;d<_e;d++)for(Et[d]=b<<7,a=0;a<1<<gt[d]-7;a++)bt[256+b++]=d;for(c=0;c<=m;c++)ue[c]=0;for(a=0;a<=143;)Ue[a++].dl=8,ue[8]++;for(;a<=255;)Ue[a++].dl=9,ue[9]++;for(;a<=279;)Ue[a++].dl=7,ue[7]++;for(;a<=287;)Ue[a++].dl=8,ue[8]++;for(Yr(Ue,fe+1),a=0;a<_e;a++)ne[a].dl=5,ne[a].fc=Zr(a,5);zr()}}function zr(){var a;for(a=0;a<fe;a++)z[a].fc=0;for(a=0;a<_e;a++)ge[a].fc=0;for(a=0;a<Re;a++)ee[a].fc=0;z[re].fc=1,st=Mt=0,ze=Ct=pr=0,yt=0,Ft=1}function gr(a,c){for(var y=J[c],d=c<<1;d<=We&&(d<We&&qr(a,J[d+1],J[d])&&d++,!qr(a,y,J[d]));)J[c]=J[d],c=d,d<<=1;J[c]=y}function Ln(a){var c=a.dyn_tree,y=a.extra_bits,d=a.extra_base,b=a.max_code,T=a.max_length,j=a.static_tree,V,A,xe,$,Ke,wr,Ht=0;for($=0;$<=m;$++)ue[$]=0;for(c[J[ot]].dl=0,V=ot+1;V<it;V++)A=J[V],$=c[c[A].dl].dl+1,$>T&&($=T,Ht++),c[A].dl=$,!(A>b)&&(ue[$]++,Ke=0,A>=d&&(Ke=y[A-d]),wr=c[A].fc,st+=wr*($+Ke),j!==null&&(Mt+=wr*(j[A].dl+Ke)));if(Ht!==0){do{for($=T-1;ue[$]===0;)$--;ue[$]--,ue[$+1]+=2,ue[T]--,Ht-=2}while(Ht>0);for($=T;$!==0;$--)for(A=ue[$];A!==0;)xe=J[--V],!(xe>b)&&(c[xe].dl!==$&&(st+=($-c[xe].dl)*c[xe].fc,c[xe].fc=$),A--)}}function Yr(a,c){var y=[],d=0,b,T;for(b=1;b<=m;b++)d=d+ue[b-1]<<1,y[b]=d;for(T=0;T<=c;T++){var j=a[T].dl;j!==0&&(a[T].fc=Zr(y[j]++,j))}}function xr(a){var c=a.dyn_tree,y=a.static_tree,d=a.elems,b,T,j=-1,V=d;for(We=0,ot=it,b=0;b<d;b++)c[b].fc!==0?(J[++We]=j=b,De[b]=0):c[b].dl=0;for(;We<2;){var A=J[++We]=j<2?++j:0;c[A].fc=1,De[A]=0,st--,y!==null&&(Mt-=y[A].dl)}for(a.max_code=j,b=We>>1;b>=1;b--)gr(c,b);do b=J[oe],J[oe]=J[We--],gr(c,oe),T=J[oe],J[--ot]=b,J[--ot]=T,c[V].fc=c[b].fc+c[T].fc,De[b]>De[T]+1?De[V]=De[b]:De[V]=De[T]+1,c[b].dl=c[T].dl=V,J[oe]=V++,gr(c,oe);while(We>=2);J[--ot]=J[oe],Ln(a),Yr(c,j)}function Xr(a,c){var y,d=-1,b,T=a[0].dl,j=0,V=7,A=4;for(T===0&&(V=138,A=3),a[c+1].dl=65535,y=0;y<=c;y++)b=T,T=a[y+1].dl,!(++j<V&&b===T)&&(j<A?ee[b].fc+=j:b!==0?(b!==d&&ee[b].fc++,ee[Fe].fc++):j<=10?ee[Me].fc++:ee[ht].fc++,j=0,d=b,T===0?(V=138,A=3):b===T?(V=6,A=3):(V=7,A=4))}function Kr(a,c){var y,d=-1,b,T=a[0].dl,j=0,V=7,A=4;for(T===0&&(V=138,A=3),y=0;y<=c;y++)if(b=T,T=a[y+1].dl,!(++j<V&&b===T)){if(j<A)do Ye(b,ee);while(--j!==0);else b!==0?(b!==d&&(Ye(b,ee),j--),Ye(Fe,ee),Ee(j-3,2)):j<=10?(Ye(Me,ee),Ee(j-3,3)):(Ye(ht,ee),Ee(j-11,7));j=0,d=b,T===0?(V=138,A=3):b===T?(V=6,A=3):(V=7,A=4)}}function Rn(){var a;for(Xr(z,be.max_code),Xr(ge,de.max_code),xr(pe),a=Re-1;a>=3&&ee[Rr[a]].dl===0;a--);return st+=3*(a+1)+5+5+4,a}function jn(a,c,y){var d;for(Ee(a-257,5),Ee(c-1,5),Ee(y-4,4),d=0;d<y;d++)Ee(ee[Rr[d]].dl,3);Kr(z,a-1),Kr(ge,c-1)}function jt(a){var c,y,d,b,T;if(b=N-h,Nt[pr]=yt,xr(be),xr(de),d=Rn(),c=st+3+7>>3,y=Mt+3+7>>3,y<=c&&(c=y),b+4<=c&&h>=0)for(Ee((e<<1)+a,3),Qr(),Lt(b),Lt(~b),T=0;T<b;T++)Dt(K[h+T]);else y===c?(Ee((r<<1)+a,3),$r(Ue,ne)):(Ee((i<<1)+a,3),jn(be.max_code+1,de.max_code+1,d+1),$r(z,ge));zr(),a!==0&&Qr()}function xt(a,c){if(pt[ze++]=c,a===0?z[c].fc++:(a--,z[mt[c]+H+1].fc++,ge[Vr(a)].fc++,dt[Ct++]=a,yt|=Ft),Ft<<=1,ze&7||(Nt[pr++]=yt,yt=0,Ft=1),ce>2&&!(ze&4095)){var y=ze*8,d=N-h,b;for(b=0;b<_e;b++)y+=ge[b].fc*(5+gt[b]);if(y>>=3,Ct<parseInt(ze/2,10)&&y<parseInt(d/2,10))return!0}return ze===l-1||Ct===k}function $r(a,c){var y,d,b=0,T=0,j=0,V=0,A,xe;if(ze!==0)do b&7||(V=Nt[j++]),d=pt[b++]&255,V&1?(A=mt[d],Ye(A+H+1,a),xe=yr[A],xe!==0&&(d-=dr[A],Ee(d,xe)),y=dt[T++],A=Vr(y),Ye(A,c),xe=gt[A],xe!==0&&(y-=Et[A],Ee(y,xe))):Ye(d,a),V>>=1;while(b<ze);Ye(re,a)}var kr=16;function Ee(a,c){M>kr-c?(L|=a<<M,Lt(L),L=a>>kr-M,M+=c-kr):(L|=a<<M,M+=c)}function Zr(a,c){var y=0;do y|=a&1,a>>=1,y<<=1;while(--c>0);return y>>1}function Qr(){M>8?Lt(L):M>0&&Dt(L),L=0,M=0}function Hn(){var a,c;if(ve!==0){for(a=Nn(),P===null?P=te=a:te=te.next=a,a.len=ve-he,c=0;c<a.len;c++)a.ptr[c]=Ae[he+c];ve=he=0}}function Vn(a,c){var y,d;At=a,mr=0,typeof c>"u"&&(c=o),Un(c),d=[];do y=Pn(d,d.length,1024);while(y>0);return At=null,d}la.exports=Vn,Xt.DEFAULT_LEVEL=o})();(function(){fa.exports={inflate:Dr,deflate:Xt}})();(function(){var t=Tt,e=Pr,r=31,i=139,o={deflate:8},s={FTEXT:1,FHCRC:2,FEXTRA:4,FNAME:8,FCOMMENT:16},n={fat:0,amiga:1,vmz:2,unix:3,"vm/cms":4,atari:5,hpfs:6,macintosh:7,"z-system":8,cplm:9,"tops-20":10,ntfs:11,qdos:12,acorn:13,vfat:14,vms:15,beos:16,tandem:17,theos:18},f="unix",u=6;function l(m,S){S.push(m&255)}function x(m,S){S.push(m&255),S.push(m>>>8)}function k(m,S){x(m&65535,S),x(m>>>16,S)}function p(m,S){var E,H=m.length;for(E=0;E<H;E+=1)l(m.charCodeAt(E),S)}function w(m){return m.shift()}function B(m){return m.shift()|m.shift()<<8}function U(m){var S=B(m),E=B(m);return E>32768?(E-=32768,(E<<16|S)+32768*Math.pow(2,16)):E<<16|S}function I(m){for(var S=[];m[0]!==0;)S.push(String.fromCharCode(m.shift()));return m.shift(),S.join("")}function G(m,S){var E,H=[];for(E=0;E<S;E+=1)H.push(m.shift());return H}function W(m,S){var E=0,H,re=[];return S||(S={}),H=S.level||u,typeof m=="string"&&(m=Array.prototype.map.call(m,function(fe){return fe.charCodeAt(0)})),l(r,re),l(i,re),l(o.deflate,re),S.name&&(E|=s.FNAME),l(E,re),k(S.timestamp||parseInt(Date.now()/1e3,10),re),l(H===1?4:H===9?2:0,re),l(n[f],re),S.name&&(p(S.name.substring(S.name.lastIndexOf("/")+1),re),l(0,re)),e.deflate(m,H).forEach(function(fe){l(fe,re)}),k(parseInt(t(m),16),re),k(m.length,re),re}function oe(m,S){var E=Array.prototype.slice.call(m,0),H,re,fe,_e,Re,Fe;if(w(E)!==r||w(E)!==i)throw"Not a GZIP file";if(H=w(E),H=Object.keys(o).some(function(Me){return re=Me,o[Me]===H}),!H)throw"Unsupported compression method";if(fe=w(E),U(E),w(E),H=w(E),Object.keys(n).some(function(Me){if(n[Me]===H)return!0}),fe&s.FEXTRA&&(H=B(E),G(E,H)),fe&s.FNAME&&I(E),fe&s.FCOMMENT&&I(E),fe&s.FHCRC&&B(E),re==="deflate"&&(Fe=e.inflate(E.splice(0,E.length-8))),fe&s.FTEXT&&(Fe=Array.prototype.map.call(Fe,function(Me){return String.fromCharCode(Me)}).join("")),_e=U(E),_e!==parseInt(t(Fe),16))throw"Checksum does not match";if(Re=U(E),Re!==Fe.length)throw"Size of decompressed file not correct";return Fe}sa.exports={zip:W,unzip:oe,get DEFAULT_LEVEL(){return u}}})();function ha(t){let e,r,i,o,s,n,f,u,l;return{c(){e=_r("h1"),r=en("Convert Midi files to Minecraft Schematic files"),i=tn(),o=_r("input"),s=tn(),n=_r("button"),f=en("Create"),this.h()},l(x){e=Tr(x,"H1",{});var k=rn(e);r=nn(k,"Convert Midi files to Minecraft Schematic files"),k.forEach(Qe),i=an(x),o=Tr(x,"INPUT",{type:!0,accept:!0}),s=an(x),n=Tr(x,"BUTTON",{});var p=rn(n);f=nn(p,"Create"),p.forEach(Qe),this.h()},h(){on(o,"type","file"),on(o,"accept",".mid,.midi")},m(x,k){kt(x,e,k),sn(e,r),kt(x,i,k),kt(x,o,k),kt(x,s,k),kt(x,n,k),sn(n,f),u||(l=[cn(o,"change",t[2]),cn(n,"click",t[1])],u=!0)},p:Sr,i:Sr,o:Sr,d(x){x&&Qe(e),x&&Qe(i),x&&Qe(o),x&&Qe(s),x&&Qe(n),u=!1,Yn(l)}}}function da(t,e,r){let i;const o=(f,u)=>{const l=new Blob([f]),x=document.createElement("a"),k=URL.createObjectURL(l);x.href=k,x.download=u,document.body.appendChild(x),x.click(),setTimeout(function(){document.body.removeChild(x),window.URL.revokeObjectURL(k)},0)},s=async()=>{if(!i||!i[0]){console.log("No file was selected");return}const f=await i[0].arrayBuffer(),u=oa(new ut.Midi(f)),l=yi(u),x=await $n(l);o(new Uint8Array(Ar.zip(x)),"result.schem")};function n(){i=this.files,r(0,i)}return[i,s,n]}class ba extends Gn{constructor(e){super(),Wn(this,e,da,ha,zn,{})}}export{ba as default};
