var bt=Object.defineProperty;var gt=(t,e,r)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var E=(t,e,r)=>(gt(t,typeof e!="symbol"?e+"":e,r),r),Pe=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var h=(t,e,r)=>(Pe(t,e,"read from private field"),r?r.call(t):e.get(t)),T=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},U=(t,e,r,i)=>(Pe(t,e,"write to private field"),i?i.call(t,r):e.set(t,r),r);var y=(t,e,r)=>(Pe(t,e,"access private method"),r);import{S as kt,i as vt,s as It,k as _e,q as ze,a as Ge,l as Me,m as We,r as Ye,h as H,c as $e,n as Ke,b as Z,G as Qe,J as Xe,H as Ee,K as Tt,o as wt}from"../chunks/index.3806aa4f.js";class xt extends Number{constructor(e){const[r]=new Int8Array([e]);super(r)}valueOf(){return super.valueOf()}get[Symbol.toStringTag](){return"Byte"}}class le extends Number{constructor(e){const[r]=new Int16Array([e]);super(r)}valueOf(){return super.valueOf()}get[Symbol.toStringTag](){return"Short"}}class G extends Number{constructor(e){const[r]=new Int32Array([e]);super(r)}valueOf(){return super.valueOf()}get[Symbol.toStringTag](){return"Int"}}class Ut extends Number{constructor(e){const[r]=new Float32Array([e]);super(r)}valueOf(){return super.valueOf()}get[Symbol.toStringTag](){return"Float"}}class se{constructor(e,{name:r,endian:i,compression:a,bedrockLevel:s}={}){if(e instanceof se&&(r===void 0&&(r=e.name),i===void 0&&(i=e.endian),a===void 0&&(a=e.compression),s===void 0&&(s=e.bedrockLevel),e=e.data),r===void 0&&(r=""),i===void 0&&(i="big"),a===void 0&&(a=null),s===void 0&&(s=null),typeof e!="object"||e===null)throw new TypeError("First parameter must be an object");if(typeof r!="string"&&r!==null)throw new TypeError("Name option must be a string or null");if(i!=="big"&&i!=="little")throw new TypeError("Endian option must be a valid endian type");if(a!==null&&a!=="gzip"&&a!=="deflate")throw new TypeError("Compression option must be a valid compression type");if(s!==null&&!(s instanceof G))throw new TypeError("Bedrock Level option must be an Int");this.data=e,this.name=r,this.endian=i,a!==null&&(this.compression=a),s!==null&&(this.bedrockLevel=s),Object.freeze(this)}get[Symbol.toStringTag](){return"NBTData"}}const I={END:0,BYTE:1,SHORT:2,INT:3,LONG:4,FLOAT:5,DOUBLE:6,BYTE_ARRAY:7,STRING:8,LIST:9,COMPOUND:10,INT_ARRAY:11,LONG_ARRAY:12};Object.freeze(I);function ee(t){switch(!0){case t instanceof xt:case typeof t=="boolean":return I.BYTE;case t instanceof le:return I.SHORT;case t instanceof G:return I.INT;case typeof t=="bigint":return I.LONG;case t instanceof Ut:return I.FLOAT;case typeof t=="number":return I.DOUBLE;case t instanceof Int8Array:return I.BYTE_ARRAY;case typeof t=="string":return I.STRING;case t instanceof Array:return I.LIST;case t instanceof Int32Array:return I.INT_ARRAY;case t instanceof BigInt64Array:return I.LONG_ARRAY;case(typeof t=="object"&&t!==null):return I.COMPOUND;default:return null}}async function Ze(t,{format:e="gzip"}={}){const r=new CompressionStream(e),i=new Blob([t]).stream().pipeThrough(r),a=await new Response(i).arrayBuffer();return new Uint8Array(a)}async function Ot(t,{name:e,endian:r,compression:i,bedrockLevel:a}={}){if(t instanceof se&&(e===void 0&&(e=t.name),r===void 0&&(r=t.endian),i===void 0&&(i=t.compression),a===void 0&&(a=t.bedrockLevel),t=t.data),typeof t!="object"||t===null)throw new TypeError("First parameter must be an object");if(e!==void 0&&typeof e!="string"&&e!==null)throw new TypeError("Name option must be a string or null");if(r!==void 0&&r!=="big"&&r!=="little")throw new TypeError("Endian option must be a valid endian type");if(i!=null&&i!=="gzip"&&i!=="deflate")throw new TypeError("Compression option must be a valid compression type");if(a!=null&&!(a instanceof G))throw new TypeError("Bedrock Level option must be an Int");let n=new Bt().write(t,{name:e,endian:r});if(a!=null){const{byteLength:f}=n,u=new Uint8Array(f+8),c=new DataView(u.buffer),d=a.valueOf();c.setUint32(0,d,!0),c.setUint32(4,f,!0),u.set(n,8),n=u}return i==="gzip"&&(n=await Ze(n,{format:"gzip"})),i==="deflate"&&(n=await Ze(n,{format:"deflate"})),n}var v,A,F,P,pe,N,_,ne,je,z,te,me,nt,ye,it,be,at,ge,st,j,q,ie,Re,ke,ot,ve,ct,Ie,ut,Q,he,Te,ft,ae,Le,we,lt,xe,ht;class Bt{constructor(){T(this,N);T(this,ne);T(this,z);T(this,me);T(this,ye);T(this,be);T(this,ge);T(this,j);T(this,ie);T(this,ke);T(this,ve);T(this,Ie);T(this,Q);T(this,Te);T(this,ae);T(this,we);T(this,xe);T(this,v,void 0);T(this,A,void 0);T(this,F,void 0);T(this,P,void 0);T(this,pe,new TextEncoder)}write(e,{name:r,endian:i}={}){if(e instanceof se&&(r===void 0&&(r=e.name),i===void 0&&(i=e.endian),e=e.data),r===void 0&&(r=""),i===void 0&&(i="big"),typeof e!="object"||e===null)throw new TypeError("First parameter must be an object");if(typeof r!="string"&&r!==null)throw new TypeError("Name option must be a string or null");if(i!=="big"&&i!=="little")throw new TypeError("Endian option must be a valid endian type");return U(this,v,0),U(this,A,i==="little"),U(this,F,new Uint8Array(1024)),U(this,P,new DataView(h(this,F).buffer)),y(this,z,te).call(this,I.COMPOUND),r!==null&&y(this,Q,he).call(this,r),y(this,ae,Le).call(this,e),y(this,N,_).call(this,0),h(this,F).slice(0,h(this,v))}}v=new WeakMap,A=new WeakMap,F=new WeakMap,P=new WeakMap,pe=new WeakMap,N=new WeakSet,_=function(e){const r=h(this,v)+e;if(h(this,F).byteLength>=r)return;let i=h(this,F).byteLength;for(;i<r;)i*=2;const a=new Uint8Array(i);a.set(h(this,F),0),h(this,v)>h(this,F).byteLength&&a.fill(0,e,h(this,v)),U(this,F,a),U(this,P,new DataView(a.buffer))},ne=new WeakSet,je=function(e){switch(ee(e)){case I.BYTE:return y(this,ye,it).call(this,Number(e));case I.SHORT:return y(this,ge,st).call(this,e.valueOf());case I.INT:return y(this,j,q).call(this,e.valueOf());case I.LONG:return y(this,ie,Re).call(this,e);case I.FLOAT:return y(this,ke,ot).call(this,e.valueOf());case I.DOUBLE:return y(this,ve,ct).call(this,e);case I.BYTE_ARRAY:return y(this,Ie,ut).call(this,e);case I.STRING:return y(this,Q,he).call(this,e);case I.LIST:return y(this,Te,ft).call(this,e);case I.COMPOUND:return y(this,ae,Le).call(this,e);case I.INT_ARRAY:return y(this,we,lt).call(this,e);case I.LONG_ARRAY:return y(this,xe,ht).call(this,e)}},z=new WeakSet,te=function(e){y(this,me,nt).call(this,e)},me=new WeakSet,nt=function(e){y(this,N,_).call(this,1),h(this,P).setUint8(h(this,v),e),U(this,v,h(this,v)+1)},ye=new WeakSet,it=function(e){y(this,N,_).call(this,1),h(this,P).setInt8(h(this,v),e),U(this,v,h(this,v)+1)},be=new WeakSet,at=function(e){y(this,N,_).call(this,2),h(this,P).setUint16(h(this,v),e,h(this,A)),U(this,v,h(this,v)+2)},ge=new WeakSet,st=function(e){y(this,N,_).call(this,2),h(this,P).setInt16(h(this,v),e,h(this,A)),U(this,v,h(this,v)+2)},j=new WeakSet,q=function(e){y(this,N,_).call(this,4),h(this,P).setInt32(h(this,v),e,h(this,A)),U(this,v,h(this,v)+4)},ie=new WeakSet,Re=function(e){y(this,N,_).call(this,8),h(this,P).setBigInt64(h(this,v),e,h(this,A)),U(this,v,h(this,v)+8)},ke=new WeakSet,ot=function(e){y(this,N,_).call(this,4),h(this,P).setFloat32(h(this,v),e,h(this,A)),U(this,v,h(this,v)+4)},ve=new WeakSet,ct=function(e){y(this,N,_).call(this,8),h(this,P).setFloat64(h(this,v),e,h(this,A)),U(this,v,h(this,v)+8)},Ie=new WeakSet,ut=function(e){const{length:r}=e;y(this,j,q).call(this,r),y(this,N,_).call(this,r),h(this,F).set(e,h(this,v)),U(this,v,h(this,v)+r)},Q=new WeakSet,he=function(e){const r=h(this,pe).encode(e),{length:i}=r;y(this,be,at).call(this,i),y(this,N,_).call(this,i),h(this,F).set(r,h(this,v)),U(this,v,h(this,v)+i)},Te=new WeakSet,ft=function(e){e=e.filter(a=>ee(a)!==null);const r=e.length!==0?ee(e[0]):I.END,{length:i}=e;y(this,z,te).call(this,r),y(this,j,q).call(this,i);for(const a of e){if(ee(a)!==r)throw new TypeError("Encountered unexpected item type in array, all tags in a List tag must be of the same type");y(this,ne,je).call(this,a)}},ae=new WeakSet,Le=function(e){for(const[r,i]of Object.entries(e)){const a=ee(i);a!==null&&(y(this,z,te).call(this,a),y(this,Q,he).call(this,r),y(this,ne,je).call(this,i))}y(this,z,te).call(this,I.END)},we=new WeakSet,lt=function(e){const{length:r}=e;y(this,j,q).call(this,r);for(const i of e)y(this,j,q).call(this,i)},xe=new WeakSet,ht=function(e){const{length:r}=e;y(this,j,q).call(this,r);for(const i of e)y(this,ie,Re).call(this,i)};const J=class{constructor(e){E(this,"name");E(this,"index");return this.name=e,this.index=J.maxTags,J.maxTags+=1,J.blocks.push(this),J.palette[this.name]=new G(this.index),this}static get(e){return J.blocks[e]}};let w=J;E(w,"maxTags",0),E(w,"blocks",[]),E(w,"palette",{});class St{constructor(e,r,i){E(this,"width");E(this,"height");E(this,"length");E(this,"blockData");this.width=new le(e),this.height=new le(r),this.length=new le(i),this.blockData=new Int8Array(e*r*i).fill(0)}positionToIndex(e,r,i){return e+i*this.width.valueOf()+r*this.width.valueOf()*this.length.valueOf()}setBlock(e,r,i,a){this.blockData[this.positionToIndex(e,r,i)]=a.index.valueOf()}getBlock(e,r,i){return this.blockData[this.positionToIndex(e,r,i)]}get Width(){return this.width.valueOf()}get Height(){return this.height.valueOf()}get Length(){return this.length.valueOf()}toNBT(){const e={Metadata:{},Version:new G(2),DataVersion:new G(2975),Width:this.width,Height:this.height,Length:this.length,BlockData:this.blockData,PaletteMax:new G(w.maxTags),Palette:w.palette};return new se(e)}}const et=new w("minecraft:air"),Ve=new w("minecraft:repeater"),D=new w("minecraft:white_concrete"),C=new w("minecraft:redstone_wire"),He=new w("minecraft:observer[facing=down]"),Nt=new w("minecraft:powered_rail[shape=east_west]"),Ct=new w("minecraft:redstone_block"),qe=new w("minecraft:redstone_lamp"),Ft=new w("minecraft:sticky_piston[facing=south]"),Pt=new w("minecraft:lever[face=floor]"),_t=[new w("minecraft:oak_planks"),new w("minecraft:white_wool"),new w("minecraft:dirt"),new w("minecraft:clay"),new w("minecraft:gold_block")],Mt=t=>{for(let e=0;e<t.Width;e++)for(let r=0;r<t.Length;r++)t.setBlock(e,0,r,D),t.setBlock(e,6,r,D)},Et=(t,e,r=0)=>{const i=(r+5)%2;for(let a=0;a<t.Length;a++)a>=5&&(a%2==i?(t.setBlock(e+1,1,a,Ve),t.setBlock(e-1,1,a,Ve)):(t.setBlock(e+1,1,a,qe),t.setBlock(e-1,1,a,qe)))},At=(t,e,r=0)=>{const i=(r+5)%2;for(let a=r+5;a<t.Length;a++)a%2!==i?t.setBlock(e+1,2,a,He):t.setBlock(e-1,2,a,He)},Dt=(t,e=0)=>{for(let r=e+5;r<t.Length;r++)for(let i=0;i<t.Width;i++)t.setBlock(i,3,r,D),t.setBlock(i,4,r,Nt),t.setBlock(i,5,r,He)},jt=(t,e,r=0)=>{for(let i=r+5;i<t.Length;i++)t.setBlock(e,7,i,qe)},Rt=(t,e,r=0)=>{Mt(t),Et(t,e,r),At(t,e,r),Dt(t,r),jt(t,e,r)},Lt=(t,e,r=0)=>{t.setBlock(e,7,r,Pt),Vt(t,e,r),Ht(t,e,r),qt(t,e,r)},Vt=(t,e,r=0)=>{t.setBlock(e,5,r+0,C),t.setBlock(e,4,r+0,D),t.setBlock(e,4,r+1,C),t.setBlock(e,3,r+1,D),t.setBlock(e+1,3,r+1,C),t.setBlock(e+1,2,r+1,D),t.setBlock(e+1,2,r+0,C),t.setBlock(e+1,1,r+0,D)},Ht=(t,e,r=0)=>{t.setBlock(e+1,1,r+1,Ve),t.setBlock(e+1,1,r+2,C),t.setBlock(e+1,1,r+3,C),t.setBlock(e+1,1,r+4,C)},qt=(t,e,r=0)=>{t.setBlock(e,1,r,C),t.setBlock(e-1,1,r,C),t.setBlock(e-2,1,r,C),t.setBlock(e-2,1,r+1,D),t.setBlock(e-2,2,r+1,C),t.setBlock(e-2,2,r+2,Ft),t.setBlock(e-2,2,r+3,D),t.setBlock(e-2,1,r+3,C),t.setBlock(e-2,0,r+3,Ct),t.setBlock(e-1,1,r+3,D),t.setBlock(e-1,2,r+3,C),t.setBlock(e-1,1,r+4,C)},dt=t=>Math.round(t*30),Jt=(t,e,r,i,a)=>{let s=e-Math.round(r.velocity*e/128);const n=dt(r.time)+a+5,f=new w(`minecraft:note_block[note=${r.midi-54}]`),u=s>e/2?-1:1;for(;s>0&&s<=e;){if(t.getBlock(e+s,7,n)===et.index){t.setBlock(e+s,7,n,f),t.setBlock(e+s,6,n,i);break}else if(t.getBlock(e-s,7,n)===et.index){t.setBlock(e-s,7,n,f),t.setBlock(e-s,6,n,i);break}s+=u}},zt=(t,e,r,i=0)=>{r.tracks.forEach((a,s)=>{a.notes.forEach(n=>{Jt(t,e,n,_t[s],i)})})},Gt=(t,e=7,r=5)=>{const i=new St(e*2+1,8,dt(t.duration+1));return Rt(i,e,r),Lt(i,e,r),zt(i,e,t,r),i.toNBT()};var $=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wt(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function i(){if(this instanceof i){var a=[null];a.push.apply(a,arguments);var s=Function.bind.apply(e,a);return new s}return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var a=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,a.get?a:{enumerable:!0,get:function(){return t[i]}})}),r}var K={},Ue={};function Yt(t){var e=new S(t),r=e.readChunk();if(r.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+r.id+"'";for(var i=$t(r.data),a=[],s=0;!e.eof()&&s<i.numTracks;s++){var n=e.readChunk();if(n.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+n.id+"'";var f=Kt(n.data);a.push(f)}return{header:i,tracks:a}}function $t(t){var e=new S(t),r=e.readUInt16(),i=e.readUInt16(),a={format:r,numTracks:i},s=e.readUInt16();return s&32768?(a.framesPerSecond=256-(s>>8),a.ticksPerFrame=s&255):a.ticksPerBeat=s,a}function Kt(t){for(var e=new S(t),r=[];!e.eof();){var i=s();r.push(i)}return r;var a;function s(){var n={};n.deltaTime=e.readVarInt();var f=e.readUInt8();if((f&240)===240)if(f===255){n.meta=!0;var u=e.readUInt8(),c=e.readVarInt();switch(u){case 0:if(n.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return n.number=e.readUInt16(),n;case 1:return n.type="text",n.text=e.readString(c),n;case 2:return n.type="copyrightNotice",n.text=e.readString(c),n;case 3:return n.type="trackName",n.text=e.readString(c),n;case 4:return n.type="instrumentName",n.text=e.readString(c),n;case 5:return n.type="lyrics",n.text=e.readString(c),n;case 6:return n.type="marker",n.text=e.readString(c),n;case 7:return n.type="cuePoint",n.text=e.readString(c),n;case 32:if(n.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return n.channel=e.readUInt8(),n;case 33:if(n.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return n.port=e.readUInt8(),n;case 47:if(n.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return n;case 81:if(n.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return n.microsecondsPerBeat=e.readUInt24(),n;case 84:if(n.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var d=e.readUInt8(),l={0:24,32:25,64:29,96:30};return n.frameRate=l[d&96],n.hour=d&31,n.min=e.readUInt8(),n.sec=e.readUInt8(),n.frame=e.readUInt8(),n.subFrame=e.readUInt8(),n;case 88:if(n.type="timeSignature",c!=2&&c!=4)throw"Expected length for timeSignature event is 4 or 2, got "+c;return n.numerator=e.readUInt8(),n.denominator=1<<e.readUInt8(),c===4?(n.metronome=e.readUInt8(),n.thirtyseconds=e.readUInt8()):(n.metronome=36,n.thirtyseconds=8),n;case 89:if(n.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return n.key=e.readInt8(),n.scale=e.readUInt8(),n;case 127:return n.type="sequencerSpecific",n.data=e.readBytes(c),n;default:return n.type="unknownMeta",n.data=e.readBytes(c),n.metatypeByte=u,n}}else if(f==240){n.type="sysEx";var c=e.readVarInt();return n.data=e.readBytes(c),n}else if(f==247){n.type="endSysEx";var c=e.readVarInt();return n.data=e.readBytes(c),n}else throw"Unrecognised MIDI event type byte: "+f;else{var o;if(f&128)o=e.readUInt8(),a=f;else{if(a===null)throw"Running status byte encountered before status byte";o=f,f=a,n.running=!0}var p=f>>4;switch(n.channel=f&15,p){case 8:return n.type="noteOff",n.noteNumber=o,n.velocity=e.readUInt8(),n;case 9:var g=e.readUInt8();return n.type=g===0?"noteOff":"noteOn",n.noteNumber=o,n.velocity=g,g===0&&(n.byte9=!0),n;case 10:return n.type="noteAftertouch",n.noteNumber=o,n.amount=e.readUInt8(),n;case 11:return n.type="controller",n.controllerType=o,n.value=e.readUInt8(),n;case 12:return n.type="programChange",n.programNumber=o,n;case 13:return n.type="channelAftertouch",n.amount=o,n;case 14:return n.type="pitchBend",n.value=o+(e.readUInt8()<<7)-8192,n;default:throw"Unrecognised MIDI event type: "+p}}}}function S(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}S.prototype.eof=function(){return this.pos>=this.bufferLen};S.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};S.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};S.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};S.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};S.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8();return(t<<16)+(e<<8)+r};S.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};S.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),r=this.readUInt8(),i=this.readUInt8();return(t<<24)+(e<<16)+(r<<8)+i};S.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};S.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};S.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};S.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),r=this.readBytes(e);return{id:t,length:e,data:r}};var Qt=Yt;function Xt(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var r=t.header||{},i=t.tracks||[],a,s=i.length,n=new x;for(Zt(n,r,s),a=0;a<s;a++)er(n,i[a],e);return n.buffer}function Zt(t,e,r){var i=e.format==null?1:e.format,a=128;e.timeDivision?a=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?a=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(a=e.ticksPerBeat&32767);var s=new x;s.writeUInt16(i),s.writeUInt16(r),s.writeUInt16(a),t.writeChunk("MThd",s.buffer)}function er(t,e,r){var i=new x,a,s=e.length,n=null;for(a=0;a<s;a++)(r.running===!1||!r.running&&!e[a].running)&&(n=null),n=tr(i,e[a],n,r.useByte9ForNoteOff);t.writeChunk("MTrk",i.buffer)}function tr(t,e,r,i){var a=e.type,s=e.deltaTime,n=e.text||"",f=e.data||[],u=null;switch(t.writeVarInt(s),a){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(n.length),t.writeString(n);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(n.length),t.writeString(n);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(n.length),t.writeString(n);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(n.length),t.writeString(n);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(n.length),t.writeString(n);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(n.length),t.writeString(n);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(n.length),t.writeString(n);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},d=e.hour&31|c[e.frameRate];t.writeUInt8(d),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var l=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(l),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(f.length),t.writeBytes(f);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(f.length),t.writeBytes(f));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(f.length),t.writeBytes(f);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(f.length),t.writeBytes(f);break;case"noteOff":var o=i!==!1&&e.byte9||i&&e.velocity==0?144:128;u=o|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==r&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==r&&t.writeUInt8(u);var p=8192+e.value,g=p&127,k=p>>7&127;t.writeUInt8(g),t.writeUInt8(k);break;default:throw"Unrecognized event type: "+a}return u}function x(){this.buffer=[]}x.prototype.writeUInt8=function(t){this.buffer.push(t&255)};x.prototype.writeInt8=x.prototype.writeUInt8;x.prototype.writeUInt16=function(t){var e=t>>8&255,r=t&255;this.writeUInt8(e),this.writeUInt8(r)};x.prototype.writeInt16=x.prototype.writeUInt16;x.prototype.writeUInt24=function(t){var e=t>>16&255,r=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(i)};x.prototype.writeInt24=x.prototype.writeUInt24;x.prototype.writeUInt32=function(t){var e=t>>24&255,r=t>>16&255,i=t>>8&255,a=t&255;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(i),this.writeUInt8(a)};x.prototype.writeInt32=x.prototype.writeUInt32;x.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};x.prototype.writeString=function(t){var e,r=t.length,i=[];for(e=0;e<r;e++)i.push(t.codePointAt(e));this.writeBytes(i)};x.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,r=[];for(r.push(e&127),e>>=7;e;){var i=e&127|128;r.push(i),e>>=7}this.writeBytes(r.reverse())}};x.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};var rr=Xt;Ue.parseMidi=Qt;Ue.writeMidi=rr;var de={},W={};Object.defineProperty(W,"__esModule",{value:!0});W.insert=W.search=void 0;function pt(t,e,r){r===void 0&&(r="ticks");var i=0,a=t.length,s=a;if(a>0&&t[a-1][r]<=e)return a-1;for(;i<s;){var n=Math.floor(i+(s-i)/2),f=t[n],u=t[n+1];if(f[r]===e){for(var c=n;c<t.length;c++){var d=t[c];d[r]===e&&(n=c)}return n}else{if(f[r]<e&&u[r]>e)return n;f[r]>e?s=n:f[r]<e&&(i=n+1)}}return-1}W.search=pt;function nr(t,e,r){if(r===void 0&&(r="ticks"),t.length){var i=pt(t,e[r],r);t.splice(i+1,0,e)}else t.push(e)}W.insert=nr;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=W,r=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var i=function(){function a(s){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",r.set(this,480),s){r.set(this,s.header.ticksPerBeat),s.tracks.forEach(function(u){u.forEach(function(c){c.meta&&(c.type==="timeSignature"?n.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?n.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&n.keySignatures.push({key:t.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var f=0;s.tracks[0].forEach(function(u){f+=u.deltaTime,u.meta&&(u.type==="trackName"?n.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&n.meta.push({text:u.text,ticks:f,type:u.type}))}),this.update()}}return a.prototype.update=function(){var s=this,n=0,f=0;this.tempos.sort(function(u,c){return u.ticks-c.ticks}),this.tempos.forEach(function(u,c){var d=c>0?s.tempos[c-1].bpm:s.tempos[0].bpm,l=u.ticks/s.ppq-f,o=60/d*l;u.time=o+n,n=u.time,f+=l}),this.timeSignatures.sort(function(u,c){return u.ticks-c.ticks}),this.timeSignatures.forEach(function(u,c){var d=c>0?s.timeSignatures[c-1]:s.timeSignatures[0],l=(u.ticks-d.ticks)/s.ppq,o=l/d.timeSignature[0]/(d.timeSignature[1]/4);d.measures=d.measures||0,u.measures=o+d.measures})},a.prototype.ticksToSeconds=function(s){var n=(0,e.search)(this.tempos,s);if(n!==-1){var f=this.tempos[n],u=f.time,c=(s-f.ticks)/this.ppq;return u+60/f.bpm*c}else{var d=s/this.ppq;return 60/120*d}},a.prototype.ticksToMeasures=function(s){var n=(0,e.search)(this.timeSignatures,s);if(n!==-1){var f=this.timeSignatures[n],u=(s-f.ticks)/this.ppq;return f.measures+u/(f.timeSignature[0]/f.timeSignature[1])/4}else return s/this.ppq/4},Object.defineProperty(a.prototype,"ppq",{get:function(){return r.get(this)},enumerable:!1,configurable:!0}),a.prototype.secondsToTicks=function(s){var n=(0,e.search)(this.tempos,s,"time");if(n!==-1){var f=this.tempos[n],u=f.time,c=s-u,d=c/(60/f.bpm);return Math.round(f.ticks+d*this.ppq)}else{var l=s/.5;return Math.round(l*this.ppq)}},a.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(s){return{bpm:s.bpm,ticks:s.ticks}}),timeSignatures:this.timeSignatures}},a.prototype.fromJSON=function(s){this.name=s.name,this.tempos=s.tempos.map(function(n){return Object.assign({},n)}),this.timeSignatures=s.timeSignatures.map(function(n){return Object.assign({},n)}),this.keySignatures=s.keySignatures.map(function(n){return Object.assign({},n)}),this.meta=s.meta.map(function(n){return Object.assign({},n)}),r.set(this,s.ppq),this.update()},a.prototype.setTempo=function(s){this.tempos=[{bpm:s,ticks:0}],this.update()},a}();t.Header=i})(de);var re={},Je={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(a,s){return a[t.controlChangeNames[s]]=s,a},{});var e=new WeakMap,r=new WeakMap,i=function(){function a(s,n){e.set(this,n),r.set(this,s.controllerType),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(a.prototype,"number",{get:function(){return r.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){var s=e.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var n=e.get(this);this.ticks=n.secondsToTicks(s)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},a}();t.ControlChange=i})(Je);var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.createControlChanges=void 0;var oe=Je;function ir(){return new Proxy({},{get:function(t,e){if(t[e])return t[e];if(oe.controlChangeIds.hasOwnProperty(e))return t[oe.controlChangeIds[e]]},set:function(t,e,r){return oe.controlChangeIds.hasOwnProperty(e)?t[oe.controlChangeIds[e]]=r:t[e]=r,!0}})}Oe.createControlChanges=ir;var Be={};Object.defineProperty(Be,"__esModule",{value:!0});Be.PitchBend=void 0;var Ae=new WeakMap,ar=function(){function t(e,r){Ae.set(this,r),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"time",{get:function(){var e=Ae.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var r=Ae.get(this);this.ticks=r.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();Be.PitchBend=ar;var Se={},V={};Object.defineProperty(V,"__esModule",{value:!0});V.DrumKitByPatchID=V.InstrumentFamilyByID=V.instrumentByPatchID=void 0;V.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];V.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];V.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Se,"__esModule",{value:!0});Se.Instrument=void 0;var ce=V,tt=new WeakMap,sr=function(){function t(e,r){if(this.number=0,tt.set(this,r),this.number=0,e){var i=e.find(function(a){return a.type==="programChange"});i&&(this.number=i.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?ce.DrumKitByPatchID[this.number]:ce.instrumentByPatchID[this.number]},set:function(e){var r=ce.instrumentByPatchID.indexOf(e);r!==-1&&(this.number=r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":ce.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var e=tt.get(this);return e.channel===9},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(e){this.number=e.number},t}();Se.Instrument=sr;var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.Note=void 0;function or(t){var e=Math.floor(t/12)-1;return mt(t)+e.toString()}function mt(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r=t%12;return e[r]}function cr(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}var ur=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(r){var i=t.exec(r),a=i[1],s=i[2],n=e[a.toLowerCase()];return n+(parseInt(s,10)+1)*12}}(),Y=new WeakMap,fr=function(){function t(e,r,i){Y.set(this,i),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=r.velocity,this.ticks=e.ticks,this.durationTicks=r.ticks-e.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return or(this.midi)},set:function(e){this.midi=ur(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var r=e-this.octave;this.midi+=r*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return mt(this.midi)},set:function(e){this.midi=12*(this.octave+1)+cr(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=Y.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var r=Y.get(this),i=r.secondsToTicks(this.time+e);this.durationTicks=i-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=Y.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var r=Y.get(this);this.ticks=r.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var e=Y.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();Ne.Note=fr;Object.defineProperty(re,"__esModule",{value:!0});re.Track=void 0;var De=W,lr=Je,hr=Oe,dr=Be,rt=Se,pr=Ne,ue=new WeakMap,mr=function(){function t(e,r){var i=this;if(this.name="",this.notes=[],this.controlChanges=(0,hr.createControlChanges)(),this.pitchBends=[],ue.set(this,r),e){var a=e.find(function(o){return o.type==="trackName"});this.name=a?a.text:""}if(this.instrument=new rt.Instrument(e,this),this.channel=0,e){for(var s=e.filter(function(o){return o.type==="noteOn"}),n=e.filter(function(o){return o.type==="noteOff"}),f=function(){var o=s.shift();u.channel=o.channel;var p=n.findIndex(function(k){return k.noteNumber===o.noteNumber&&k.absoluteTime>=o.absoluteTime});if(p!==-1){var g=n.splice(p,1)[0];u.addNote({durationTicks:g.absoluteTime-o.absoluteTime,midi:o.noteNumber,noteOffVelocity:g.velocity/127,ticks:o.absoluteTime,velocity:o.velocity/127})}},u=this;s.length;)f();var c=e.filter(function(o){return o.type==="controller"});c.forEach(function(o){i.addCC({number:o.controllerType,ticks:o.absoluteTime,value:o.value/127})});var d=e.filter(function(o){return o.type==="pitchBend"});d.forEach(function(o){i.addPitchBend({ticks:o.absoluteTime,value:o.value/Math.pow(2,13)})});var l=e.find(function(o){return o.type==="endOfTrack"});this.endOfTrackTicks=l!==void 0?l.absoluteTime:void 0}}return t.prototype.addNote=function(e){var r=ue.get(this),i=new pr.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},r);return Object.assign(i,e),(0,De.insert)(this.notes,i,"ticks"),this},t.prototype.addCC=function(e){var r=ue.get(this),i=new lr.ControlChange({controllerType:e.number},r);return delete e.number,Object.assign(i,e),Array.isArray(this.controlChanges[i.number])||(this.controlChanges[i.number]=[]),(0,De.insert)(this.controlChanges[i.number],i,"ticks"),this},t.prototype.addPitchBend=function(e){var r=ue.get(this),i=new dr.PitchBend({},r);return Object.assign(i,e),(0,De.insert)(this.pitchBends,i,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,r=0;r<this.notes.length-1;r++){var i=this.notes[r].time+this.notes[r].duration;e<i&&(e=i)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,r=0;r<this.notes.length-1;r++){var i=this.notes[r].ticks+this.notes[r].durationTicks;e<i&&(e=i)}return e},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e){var r=this;this.name=e.name,this.channel=e.channel,this.instrument=new rt.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var i in e.controlChanges)e.controlChanges[i]&&e.controlChanges[i].forEach(function(a){r.addCC({number:a.number,ticks:a.ticks,value:a.value})});e.notes.forEach(function(a){r.addNote({durationTicks:a.durationTicks,midi:a.midi,ticks:a.ticks,velocity:a.velocity})})},t.prototype.toJSON=function(){for(var e={},r=0;r<127;r++)this.controlChanges.hasOwnProperty(r)&&(e[r]=this.controlChanges[r].map(function(a){return a.toJSON()}));var i={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(a){return a.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(a){return a.toJSON()})};return this.endOfTrackTicks!==void 0&&(i.endOfTrackTicks=this.endOfTrackTicks),i},t}();re.Track=mr;var Ce={};function yr(t){var e=[];return yt(t,e),e}function yt(t,e){for(var r=0;r<t.length;r++){var i=t[r];Array.isArray(i)?yt(i,e):e.push(i)}}const br=Object.freeze(Object.defineProperty({__proto__:null,flatten:yr},Symbol.toStringTag,{value:"Module"})),gr=Wt(br);var L=$&&$.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,a=e.length,s;i<a;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.encode=void 0;var kr=Ue,vr=de,Ir=gr;function Tr(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(t.velocity*127)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(t.noteOffVelocity*127)}]}function wr(t){return(0,Ir.flatten)(t.notes.map(function(e){return Tr(e,t.channel)}))}function xr(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(t.value*127)}}function Ur(t){for(var e=[],r=0;r<127;r++)t.controlChanges.hasOwnProperty(r)&&t.controlChanges[r].forEach(function(i){e.push(xr(i,t.channel))});return e}function Or(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function Br(t){var e=[];return t.pitchBends.forEach(function(r){e.push(Or(r,t.channel))}),e}function Sr(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function Nr(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function Cr(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function Fr(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Pr(t){var e=vr.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:t.scale==="major"?0:1,type:"keySignature"}}function _r(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function Mr(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:L([L(L(L(L([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(r){return Pr(r)}),!0),t.header.meta.map(function(r){return _r(r)}),!0),t.header.tempos.map(function(r){return Cr(r)}),!0),t.header.timeSignatures.map(function(r){return Fr(r)}),!0)],t.tracks.map(function(r){return L(L(L([Nr(r.name),Sr(r)],wr(r),!0),Ur(r),!0),Br(r),!0)}),!0)};return e.tracks=e.tracks.map(function(r){r=r.sort(function(a,s){return a.absoluteTime-s.absoluteTime});var i=0;return r.forEach(function(a){a.deltaTime=a.absoluteTime-i,i=a.absoluteTime,delete a.absoluteTime}),r.push({deltaTime:0,meta:!0,type:"endOfTrack"}),r}),new Uint8Array((0,kr.writeMidi)(e))}Ce.encode=Mr;(function(t){var e=$&&$.__awaiter||function(l,o,p,g){function k(m){return m instanceof p?m:new p(function(B){B(m)})}return new(p||(p=Promise))(function(m,B){function M(O){try{b(g.next(O))}catch(X){B(X)}}function R(O){try{b(g.throw(O))}catch(X){B(X)}}function b(O){O.done?m(O.value):k(O.value).then(M,R)}b((g=g.apply(l,o||[])).next())})},r=$&&$.__generator||function(l,o){var p={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},g,k,m,B;return B={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function M(b){return function(O){return R([b,O])}}function R(b){if(g)throw new TypeError("Generator is already executing.");for(;p;)try{if(g=1,k&&(m=b[0]&2?k.return:b[0]?k.throw||((m=k.return)&&m.call(k),0):k.next)&&!(m=m.call(k,b[1])).done)return m;switch(k=0,m&&(b=[b[0]&2,m.value]),b[0]){case 0:case 1:m=b;break;case 4:return p.label++,{value:b[1],done:!1};case 5:p.label++,k=b[1],b=[0];continue;case 7:b=p.ops.pop(),p.trys.pop();continue;default:if(m=p.trys,!(m=m.length>0&&m[m.length-1])&&(b[0]===6||b[0]===2)){p=0;continue}if(b[0]===3&&(!m||b[1]>m[0]&&b[1]<m[3])){p.label=b[1];break}if(b[0]===6&&p.label<m[1]){p.label=m[1],m=b;break}if(m&&p.label<m[2]){p.label=m[2],p.ops.push(b);break}m[2]&&p.ops.pop(),p.trys.pop();continue}b=o.call(l,p)}catch(O){b=[6,O],k=0}finally{g=m=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var i=Ue,a=de,s=re,n=Ce,f=function(){function l(o){var p=this,g=null;if(o){var k=o instanceof ArrayBuffer?new Uint8Array(o):o;g=(0,i.parseMidi)(k),g.tracks.forEach(function(m){var B=0;m.forEach(function(M){B+=M.deltaTime,M.absoluteTime=B})}),g.tracks=d(g.tracks)}this.header=new a.Header(g),this.tracks=[],o&&(this.tracks=g.tracks.map(function(m){return new s.Track(m,p.header)}),g.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return l.fromUrl=function(o){return e(this,void 0,void 0,function(){var p,g;return r(this,function(k){switch(k.label){case 0:return[4,fetch(o)];case 1:return p=k.sent(),p.ok?[4,p.arrayBuffer()]:[3,3];case 2:return g=k.sent(),[2,new l(g)];case 3:throw new Error("Could not load '".concat(o,"'"))}})})},Object.defineProperty(l.prototype,"name",{get:function(){return this.header.name},set:function(o){this.header.name=o},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"duration",{get:function(){var o=this.tracks.map(function(p){return p.duration});return Math.max.apply(Math,o)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"durationTicks",{get:function(){var o=this.tracks.map(function(p){return p.durationTicks});return Math.max.apply(Math,o)},enumerable:!1,configurable:!0}),l.prototype.addTrack=function(){var o=new s.Track(void 0,this.header);return this.tracks.push(o),o},l.prototype.toArray=function(){return(0,n.encode)(this)},l.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(o){return o.toJSON()})}},l.prototype.fromJSON=function(o){var p=this;this.header=new a.Header,this.header.fromJSON(o.header),this.tracks=o.tracks.map(function(g){var k=new s.Track(void 0,p.header);return k.fromJSON(g),k})},l.prototype.clone=function(){var o=new l;return o.fromJSON(this.toJSON()),o},l}();t.Midi=f;var u=re;Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return u.Track}});var c=de;Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return c.Header}});function d(l){for(var o=[],p=0;p<l.length;p++)for(var g=o.length,k=new Map,m=Array(16).fill(0),B=0,M=l[p];B<M.length;B++){var R=M[B],b=g,O=R.channel;if(O!==void 0){R.type==="programChange"&&(m[O]=R.programNumber);var X=m[O],Fe="".concat(X," ").concat(O);k.has(Fe)?b=k.get(Fe):(b=g+k.size,k.set(Fe,b))}o[b]||o.push([]),o[b].push(R)}return o}})(K);const fe=[6,30,54,78,102,126],Er=t=>{const e=new K.Midi;for(let r=0;r<fe.length-1;r++){const i=54-fe[r],a=new K.Midi;t.tracks.forEach(s=>{const n=new K.Track([],new K.Header);s.notes.forEach(f=>{fe[r]<f.midi&&f.midi<fe[r+1]&&(f.midi+=i,n.addNote(f))}),a.tracks.push(n)}),e.tracks.push(a.tracks[0])}return e};function Ar(t){let e,r,i,a,s,n,f,u,c;return{c(){e=_e("h1"),r=ze("Convert Midi files to Minecraft Schematic files"),i=Ge(),a=_e("input"),s=Ge(),n=_e("button"),f=ze("Create"),this.h()},l(d){e=Me(d,"H1",{});var l=We(e);r=Ye(l,"Convert Midi files to Minecraft Schematic files"),l.forEach(H),i=$e(d),a=Me(d,"INPUT",{type:!0,accept:!0}),s=$e(d),n=Me(d,"BUTTON",{});var o=We(n);f=Ye(o,"Create"),o.forEach(H),this.h()},h(){Ke(a,"type","file"),Ke(a,"accept",".mid,.midi")},m(d,l){Z(d,e,l),Qe(e,r),Z(d,i,l),Z(d,a,l),Z(d,s,l),Z(d,n,l),Qe(n,f),u||(c=[Xe(a,"change",t[2]),Xe(n,"click",t[1])],u=!0)},p:Ee,i:Ee,o:Ee,d(d){d&&H(e),d&&H(i),d&&H(a),d&&H(s),d&&H(n),u=!1,Tt(c)}}}function Dr(t,e,r){let i;const a=(f,u,c)=>{var d=new Blob([f],{type:c}),l=document.createElement("a"),o=URL.createObjectURL(d);l.href=o,l.download=u,document.body.appendChild(l),l.click(),setTimeout(function(){document.body.removeChild(l),window.URL.revokeObjectURL(o)},0)},s=async()=>{if(!i||!i[0]){console.log("No file was selected");return}const f=await i[0].arrayBuffer(),u=Er(new K.Midi(f)),c=Gt(u),d=await Ot(c);a(d,"result.nbt","wow")};wt(async()=>{console.log()});function n(){i=this.files,r(0,i)}return[i,s,n]}class Lr extends kt{constructor(e){super(),vt(this,e,Dr,Ar,It,{})}}export{Lr as default};
